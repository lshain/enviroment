var DISQUS=function(e){var d={AssertionError:function(d){this.message=d}};d.AssertionError.prototype.toString=function(){return"Assertion Error: "+(this.message||"[no message]")};d.assert=function(f,c){if(!f)throw new d.AssertionError(c);};var f=[];d.define=function(i,c){typeof i==="function"&&(c=i,i="");for(var k=i.split("."),a=k.shift(),h=d,o=(c||function(){return{}}).call({overwrites:function(a){a.__overwrites__=!0;return a}},e);a;)h=h[a]?h[a]:h[a]={},a=k.shift();for(var l in o)o.hasOwnProperty(l)&&
(o.__overwrites__||h[l]!==null&&d.assert(!h.hasOwnProperty(l),"Unsafe attempt to redefine existing module with "+l),h[l]=o[l],f.push(function(a,c){return function(){delete a[c]}}(h,l)));return h};d.use=function(f){return d.define(f)};d.cleanup=function(){for(var d=0;d<f.length;d++)f[d]()};return d}(this);
DISQUS.define(function(e,d){var f=e.document,i=f.getElementsByTagName("head")[0]||f.body,c={running:!1,timer:null,queue:[]};DISQUS.defer=function(d,a){function h(){var a=c.queue;if(a.length===0)c.running=!1,clearInterval(c.timer);for(var h=0,d;d=a[h];h++)d[0]()&&(a.splice(h--,1),d[1]())}c.queue.push([d,a]);h();if(!c.running)c.running=!0,c.timer=setInterval(h,100)};DISQUS.each=function(c,a){var h=c.length,d=Array.prototype.forEach;if(isNaN(h))for(var f in c)c.hasOwnProperty(f)&&a(c[f],f,c);else if(d)d.call(c,
a);else for(d=0;d<h;d++)a(c[d],d,c)};DISQUS.extend=function(c){DISQUS.each(Array.prototype.slice.call(arguments,1),function(a){for(var h in a)c[h]=a[h]});return c};DISQUS.serializeArgs=function(c){var a=[];DISQUS.each(c,function(c,f){c!==d&&a.push(f+(c!==null?"="+encodeURIComponent(c):""))});return a.join("&")};DISQUS.isString=function(c){return Object.prototype.toString.call(c)==="[object String]"};DISQUS.serialize=function(c,a,h){a&&(c+=~c.indexOf("?")?c.charAt(c.length-1)=="&"?"":"&":"?",c+=DISQUS.serializeArgs(a));
if(h)return a={},a[(new Date).getTime()]=null,DISQUS.serialize(c,a);a=c.length;return c.charAt(a-1)=="&"?c.slice(0,a-1):c};DISQUS.require=function(c,a,h,d,e){function r(a){if(a.type=="load"||/^(complete|loaded)$/.test(a.target.readyState))d&&d(),m&&clearTimeout(m),DISQUS.bean.remove(a.target,j,r)}var q=f.createElement("script"),j=q.addEventListener?"load":"readystatechange",m=null;q.src=DISQUS.serialize(c,a,h);q.async=!0;q.charset="UTF-8";(d||e)&&DISQUS.bean.add(q,j,r);e&&(m=setTimeout(function(){e()},
2E4));i.appendChild(q);return DISQUS};DISQUS.requireStylesheet=function(c,a,h){var d=f.createElement("link");d.rel="stylesheet";d.type="text/css";d.href=DISQUS.serialize(c,a,h);i.appendChild(d);return DISQUS};DISQUS.requireSet=function(c,a,h){var d=c.length;DISQUS.each(c,function(c){DISQUS.require(c,{},a,function(){--d===0&&h()})})};DISQUS.injectCss=function(c){var a=f.createElement("style");a.setAttribute("type","text/css");c=c.replace(/\}/g,"}\n");e.location.href.match(/^https/)&&(c=c.replace(/http:\/\//g,
"https://"));a.styleSheet?a.styleSheet.cssText=c:a.appendChild(f.createTextNode(c));i.appendChild(a)}});
DISQUS.define("JSON",function(){function e(a){return a<10?"0"+a:a}function d(c){a.lastIndex=0;return a.test(c)?'"'+c.replace(a,function(a){var c=l[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}function f(a,e){var p,i,k,l,j=h,t,n=e[a];n&&typeof n==="object"&&typeof n.toJSON==="function"&&!c&&(n=n.toJSON(a));typeof r==="function"&&(n=r.call(e,a,n));switch(typeof n){case "string":return d(n);case "number":return isFinite(n)?String(n):"null";case "boolean":case "null":return String(n);
case "object":if(!n)return"null";h+=o;t=[];if(Object.prototype.toString.apply(n)==="[object Array]"){l=n.length;for(p=0;p<l;p+=1)t[p]=f(p,n)||"null";k=t.length===0?"[]":h?"[\n"+h+t.join(",\n"+h)+"\n"+j+"]":"["+t.join(",")+"]";h=j;return k}if(r&&typeof r==="object"){l=r.length;for(p=0;p<l;p+=1)i=r[p],typeof i==="string"&&(k=f(i,n))&&t.push(d(i)+(h?": ":":")+k)}else for(i in n)Object.hasOwnProperty.call(n,i)&&(k=f(i,n))&&t.push(d(i)+(h?": ":":")+k);k=t.length===0?"{}":h?"{\n"+h+t.join(",\n"+h)+"\n"+
j+"}":"{"+t.join(",")+"}";h=j;return k}}var i={},c=!1;if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var k=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h,o,l={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},r;i.stringify=function(a,c,d){var e;o=h="";if(typeof d==="number")for(e=0;e<d;e+=1)o+=" ";else typeof d==="string"&&(o=d);if((r=c)&&typeof c!=="function"&&(typeof c!=="object"||typeof c.length!=="number"))throw Error("JSON.stringify");return f("",{"":a})};i.parse=function(a,c){function h(a,
d){var e,t,n=a[d];if(n&&typeof n==="object")for(e in n)Object.hasOwnProperty.call(n,e)&&(t=h(n,e),t!==void 0?n[e]=t:delete n[e]);return c.call(a,d,n)}var d,a=String(a);k.lastIndex=0;k.test(a)&&(a=a.replace(k,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),
typeof c==="function"?h({"":d},""):d;throw new SyntaxError("JSON.parse");};var q={a:[1,2,3]},j,m;if(Object.toJSON&&Object.toJSON(q).replace(/\s/g,"")==='{"a":[1,2,3]}')j=Object.toJSON;typeof String.prototype.evalJSON==="function"&&(q='{"a":[1,2,3]}'.evalJSON(),q.a&&q.a.length===3&&q.a[2]===3&&(m=function(a){return a.evalJSON()}));(function(){var a=[1,2,3];typeof a.toJSON==="function"&&(a=a.toJSON(),c=!(a&&a.length===3&&a[2]===3))})();if(c||!j||!m)return{stringify:i.stringify,parse:i.parse};return{stringify:j,
parse:m}});
DISQUS.define("Bus",function(){function e(a){a=a.split("/");return a[0]+"//"+a[2]}var d=DISQUS.use("JSON"),f=window.location.hash.slice(1),i=window.parent,c=document.referrer,k={};k.client=e(document.location.href);k.host=c?e(c):k.client;return{origins:k,postMessage:function(a){a.sender=f;a=d.stringify(a);i.postMessage(a,k.host)},sendHostMessage:function(a,c){c=c||[];DISQUS.Bus.postMessage({scope:"host",name:a,data:c})},sendGlobalMessage:function(a,c){c=c||[];DISQUS.Bus.postMessage({scope:"global",name:a,
data:c})}}});_.extend(DISQUS.Bus,Backbone.Events);$(document).ready(function(){var e=window.addEventListener?window.addEventListener:window.attachEvent,d=window.addEventListener?"message":"onmessage";if(!e)throw Error("No event support.");e(d,function(d){var e=DISQUS.Bus,c=d.origin;if(!(c!=e.origins.client&&c!=e.origins.host)){var k;try{k=DISQUS.JSON.parse(d.data)}catch(a){return}d=k.data;switch(k.scope){case "client":e.trigger(d.eventName,d.data)}}},!1)});
DISQUS.define(function(e,d){var f={blocks:{},ISO_8601:"YYYY-MM-DDTHH:mm:ssZ",apiKey:"E8Uh5l5fHZ6gD8U3KycjAIAk46f68Zw7C6eW8WSjZvCLXebZ7p0r1yrYDrLilk2F",bean:require("bean"),debug:!1,browser:{mobile:navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i)},modules:{},strings:{translations:{}}};f.strings.get=_.bind(function(c){var e=this.translations[c];return e!==d?e:c},f.strings);f.interpolate=function(c,e){return c.replace(/%\(\w+\)s/g,function(a){a=a.slice(2,-2);if(a in e)a=e[a]!==
d?e[a].toString():"";else throw"Key "+a+" not found in context";return a})};f.addBlocks=function(){return function(c){c(DISQUS)}};f.templateGlobals={urls:DISQUS.use("urls"),sso:null,trans:f.strings.get,_:{pluralize:_.pluralize}};f.renderBlock=function(c,d){return DISQUS.blocks[c](f.templateGlobals,d)};f.assureOffset=function(c){return c.indexOf("+")>=0?c:c+"+00:00"};var i=f.Builder=function(){this.accum=[]};_.extend(i.prototype,{put:function(c){this.accum.push(c)},esc:function(c){return String(c).replace(/&/g,
"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},compile:function(){return this.accum.join("")}});return f});
DISQUS.define("urls",function(){var e=encodeURIComponent(document.referrer),d={root:"http://disqus.com",media:"http://mediacdn.disqus.com/1347498379",loading:"http://mediacdn.disqus.com/1347498379/html/simple-loading.html",realertime:"http://realtime.services.disqus.com",login:"https://disqus.com/next/login/",api:"http://disqus.com/api/3.0/",apiSecure:"https://disqus.com/api/3.0/",logout:"http://disqus.com/logout/?redirect="+e,editProfile:"http://disqus.com/account/",verifyEmail:"https://disqus.com/next/verify/",
authorize:"https://disqus.com/api/oauth/2.0/authorize/",moderate:"http://disqus.com/admin/moderate/",oauth:{twitter:"http://disqus.com/_ax/twitter/begin/",google:"http://disqus.com/_ax/google/begin/",facebook:"http://disqus.com/_ax/facebook/begin/"},avatar:{generic:"http://mediacdn.disqus.com/1347498379/images/noavatar92.png"}};window.location.protocol==="https:"&&(d=_.extend(d,{root:"https://disqus.com",media:"https://securecdn.disqus.com/1347498379",loading:"https://securecdn.disqus.com/1347498379/html/simple-loading.html",
realertime:d.realertime.replace("http://","https://"),api:d.apiSecure,logout:"https://disqus.com/logout/?redirect="+e,editProfile:"https://disqus.com/account/",moderate:"https://disqus.com/admin/moderate/",oauth:{twitter:"https://disqus.com/_ax/twitter/begin/",google:"https://disqus.com/_ax/google/begin/",facebook:"http://disqus.com/_ax/facebook/begin/"},avatar:{generic:"https://securecdn.disqus.com/1347498379/images/noavatar92.png"}}));return d});
DISQUS.define("api",function(){function e(d){function c(a){var f=a.originalEvent.origin;DISQUS.urls.apiSecure.slice(0,f.length)===f&&(a=DISQUS.JSON.parse(a.originalEvent.data),a.requestId==e&&(f=a.code===0?d.success:d.error,delete a.requestId,(f||function(){})(a),document.body.removeChild(l),document.body.removeChild(h),$(window).unbind("message",c)))}var e=_.uniqueId(),a=document.createElement("div"),h=document.createElement("form"),f="frame_"+e,l;a.innerHTML='<iframe name="'+f+'"></iframe>';l=a.childNodes[0];
h.target=f;h.action=d.url.replace(".json",".pm");h.method=d.method||"GET";d.data=_.extend(d.data,{callback:e,referrer:document.referrer});_.each(d.data,function(a,c){a===!0?a=[1]:a===!1?a=[0]:a===null?a=[""]:_.isArray(a)||(a=[a]);_.each(a,function(a){var d=document.createElement("input");d.type="hidden";d.name=c;d.value=a;h.appendChild(d)})});$(window).bind("message",c);document.body.appendChild(l);document.body.appendChild(h);h.submit()}function d(d){d=_.defaults(d,f);d.data=d.data||{};d.data.api_key=
DISQUS.apiKey;$.ajax(d)}var f={};return{defaults:function(d){_.extend(f,d)},getURL:function(d,c){c=c||{};if(c.secure||window.location.protocol==="https:")return DISQUS.urls.apiSecure+d;return DISQUS.urls.api+d},ajax:d,call:function(f,c){c=c||{};c.url=DISQUS.api.getURL(f,{secure:c.secure});c.data=_.extend(c.data||{},{api_key:DISQUS.apiKey});(c.secure?e:d)(c)}}});
(function(e){e.ajax=function(d){d.method=d.type;d.type=d.dataType;delete d.dataType;return DISQUS.api.ajax(d)};e.Collection.prototype.parse=function(d){return d.response}})(Backbone);
DISQUS.define("cookies",function(){return{create:function(e,d,f){e=e+"="+d+"; path=/";f.domain&&(e+="; domain=."+f.domain);f.expiresIn&&(d=new Date,d.setTime(d.getTime()+f.expiresIn),e+="; expires="+d.toGMTString());document.cookie=e},read:function(e){e+="=";for(var d=document.cookie.split(";"),f,i=0;i<d.length;i++){for(f=d[i];f.charAt(0)==" ";)f=f.substring(1,f.length);if(f.indexOf(e)===0)return f.substring(e.length,f.length)}return null},erase:function(e,d){var f=new Date;f.setTime(f.getTime()+
-864E5);f=e+"=; path=/;expires="+f.toGMTString();d.domain&&(f+="; domain=."+d.domain);document.cookie=f}}});
DISQUS.define("lounge.utils",function(){function e(a){function c(a){a=Number(a).toString(16);return a.length==1?"0"+a:a}if(a.substr(0,1)==="#")return a;var d=/.*?rgb\((\d+),\s*(\d+),\s*(\d+)\)/.exec(a);if(!d||d.length!==4)return"";var a=c(d[1]),e=c(d[2]),d=c(d[3]);return"#"+a+e+d}var d=RegExp("[\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E\\u00A1-\\u00BF\\u2010-\\u2027\\u2030-\\u205E\\u2300-\\u23FF\\u2E00-\\u2E7F\\u3001-\\u303F\\uFE10-\\uFE19\\uFE30-\\uFE4F\\uFE50-\\uFE6B\\uFF01-\\uFF0F\\uFF1A-\\uFF20\\uFF3B-\\uFF40\\uFF5B-\\uFF60\\uFF5F-\\uFF64]+$"),f=
{domain:DISQUS.urls.root.split("/")[2],create:function(a,c){DISQUS.cookies.create(a,c,{domain:f.domain,expiresIn:31536E6})},read:DISQUS.cookies.read,erase:function(a){DISQUS.cookies.erase(a,{domain:f.domain})}},i=function(){var a={};return{getItem:function(c){return a.hasOwnProperty(c)?a[c]:null},setItem:function(c,d){a[c]=String(d)},removeItem:function(c){delete a[c]}}}(),c=/^[a-z0-9_.%+\-]+@[0-9a-z.\-]+\.[a-z.]{2,6}$/i,k=function(){function a(){this.state=null;this.queue=[]}_.extend(a.prototype,
{highlight:function(a){this.state===null&&this._load();this.queue.push(a);this.state===2&&this._flush()},_load:function(){var a=this;a.state=1;DISQUS.require("http://mediacdn.disqus.com/1347498379/build/js/highlight.js",{},!1,function(){a.state=2;a._flush()})},_flush:function(){_.chainedDefer(this.queue,function(a){var c=$(a).html();$(a).html(c.replace(/^<br>/,""));hljs.highlightBlock(a)},this)}});return new a}();return{attempt:function(a,c){try{_.bind(a,c||{})()}catch(d){return d}return null},extract:function(a,
c){for(var d=c.split("."),e=d.shift();e;){if(d.length===0)return a[e];if(!_.isObject(a[e]))return;a=a[e];e=d.shift()}return a},addStylesheetRules:function(a){function c(){var e=_.find(document.styleSheets,function(a){return(a.ownerNode||a.owningElement).id===d});if(!e)return void setTimeout(c,50);for(var f=0,i=a.length;f<i;f++){var k=1,l=a[f],w=l[0],p="";Object.prototype.toString.call(l[1][0])==="[object Array]"&&(l=l[1],k=0);for(var y=l.length;k<y;k++){var z=l[k];p+=z[0]+":"+z[1]+(z[2]?" !important":
"")+";\n"}e.insertRule?e.insertRule(w+"{"+p+"}",e.cssRules.length):e.addRule(w,p,-1)}}var d="css_"+(new Date).getTime(),e=document.createElement("style");e.id=d;document.getElementsByTagName("head")[0].appendChild(e);window.createPopup||e.appendChild(document.createTextNode(""));c()},escapeColor:function(a){return e(a).replace(/[^#A-Fa-f0-9]/g,"")},makeCORSRequest:function(a,c,d){d=d||function(){};if(typeof XMLHttpRequest=="undefined")return null;var e=new XMLHttpRequest;if("withCredentials"in e)e.open(a,
c,!0),e.onreadystatechange=d;else if(typeof XDomainRequest!="undefined"){if(a!=="GET"&&a!=="POST")return null;e=new XDomainRequest;e.open(a,c);e.onload=d}else e=null;return e},hashStorage:i,cookies:f,niceTruncate:function(a,c){if(a.length<=c)return a;var e=a=a.slice(0,c-1),f=/(^.*\S)\s/.exec(a);f&&(a=f[1]);(f=d.exec(a))&&(a=a.slice(0,a.length-f[0].length));a.length<0.5*e.length&&(a=e);return a+"\u2026"},htmlDecode:function(a){var c=document.createElement("div");c.innerHTML=a;return c.childNodes.length===
0?"":c.childNodes[0].nodeValue},isWindowClosed:function(a){if(!a)return!0;try{return a.closed||a.closed===void 0}catch(c){return!0}},validateEmail:function(a){return c.test(a)},updateURL:function(a,c){var d=document.createElement("a"),c=c||{};d.href=a;c.hostname&&c.hostname.match(/\.$/)&&(c.hostname+=d.hostname);d=_.extend({protocol:d.protocol,hostname:d.hostname,pathname:d.pathname,search:d.search},c);if(!d.pathname.match(/^\//))d.pathname="/"+d.pathname;return d.protocol+"//"+d.hostname+d.pathname+
d.search},syntaxHighlighter:k}});
DISQUS.define("lounge.realtime",function(){function e(c){this.url=c+"?"+ +new Date;this.xhr=null;this.len=0}function d(c){this.uid=+new Date;this.url=c;this.main=null;this.data=[];this.c1=new f("c1",c+"?"+this.uid+"_c1");this.c2=new f("c2",c+"?"+this.uid+"_c2");this.chaos=!1;this.interval=1;_([this.c1,this.c2]).each(_.bind(function(c){c.on("progress",this.onProgress,this);c.on("error",this.onError,this);c.on("success",this.onSuccess,this)},this))}function f(c,d){this.name=c;this.url=d;this.xhr=null}
var i=DISQUS.use("lounge.utils");_.extend(e.prototype,Backbone.Events,{onLoad:function(){var c=this.xhr;c.readyState!==void 0&&c.readyState!=4||c.status!==void 0&&c.status!==200||this.trigger("success")},onError:function(){this.trigger("error")},onProgress:function(){var c=this,d=c.xhr.responseText,a=0;d&&c.len!==d.length&&(d=d.slice(c.len).split("\n"),_.each(d,function(d){a+=d.length+1;try{d=JSON.parse(d)}catch(e){a-=d.length+1;return}c.trigger("progress",d)}),c.len+=a)},run:function(){var c=this;
c.xhr=i.makeCORSRequest("GET",c.url,function(){c.onLoad()});c.xhr.onerror=function(){c.onError()};c.xhr.onprogress=function(){c.onProgress()};try{c.xhr.send()}catch(d){DISQUS.log("Attempt to send a CORS request failed.")}}});_.extend(d.prototype,Backbone.Events,{run:function(c){c=c||"c1";if(!(this.chaos&&c!=="c1"))this.main=c,this[c].run(),DISQUS.log("RT: started a new connection "+c),this.chaos?(DISQUS.logError("RT: chaos mode"),this.interval<=120&&(this.interval*=2),_.delay(_.bind(this.run,this,
"c1"),85E3,"c1")):_.delay(_.bind(this.run,this,c=="c1"?"c2":"c1"),85E3)},onProgress:function(c,d){this.main===c&&this.trigger("progress",d)},onError:function(){this.chaos=!0},onSuccess:function(){this.chaos=!1}});_.extend(f.prototype,Backbone.Events,{run:function(){var c=this,d=0,a;a=i.makeCORSRequest("GET",c.url,function(){a.readyState!==void 0&&a.readyState!==4||(a.status!==void 0&&a.status!==200&&c.trigger("error"),c.trigger("success"))});a.onerror=function(){c.trigger("error")};a.onprogress=function(){if(a.responseText){var e=
a.responseText.split("\n"),f,l;if(e.length!==d)for(;d<e.length;){if(f=i.attempt(function(){l=JSON.parse(e[d])}))break;d+=1;c.trigger("progress",c.name,[l])}}};a.send();c.xhr=a}});return{Firehose:e,Pool:d,Connection:f}});
DISQUS.define("lounge.models",function(){function e(a,c,d){var f=e.pool[a.__type__],p=c&&c[a.prototype.idAttribute];if(!f)throw Error("Model not registered. Use UniqueModel.addType");if(!p)return new a(c,d);f[p]?f[p].set(c):f[p]=new a(c,d);return f[p]}var d=DISQUS.use("lounge.collections"),f=DISQUS.use("lounge.utils"),i=DISQUS.use("Bus");e.pool={};e.addType=function(a,c){if(!c.__type__||!e.pool[a])c.__type__=a,e.pool[a]={}};var c=Backbone.Model.extend({defaults:{settings:{}}}),k=Backbone.Model.extend({defaults:{author:null,
category:null,createdAt:null,forum:null,identifiers:[],ipAddress:null,isClosed:!1,isDeleted:!1,hasStreaming:!1,link:null,message:null,slug:null,title:null,userSubscription:!1,posts:0,reactions:0,likes:0,dislikes:0,userScore:0},initialize:function(a,c){var e=this,c=c||{};e.moderators=c.moderators;e.forum=c.forum;e.users=new d.UserCollection(c.users,{thread:e});e.posts=new d.PostCollection(c.posts,{thread:e,cursor:c.postCursor});e.reactions=new d.ReactionsCollection(null,{thread:e});e.votes=new d.ThreadVoteCollection;
e.posts.bind("add reset",function(a){a=a.models?a.models:[a];_.each(a,function(a){e.users.get(a.author.id)||e.users.add(a.author)})});e.posts.bind("destroy",function(){e.set("posts",e.get("posts")-1)});e.bind("change:posts",e.broadcastPostCount,e);e.queue=new d.QueuedPostCollection(null,{thread:e})},_vote:function(a,c){var d=a-c;if(d===0)return d;this.set("likes",this.get("likes")+d);return d},vote:function(a){var c=this;c._vote(a,c.get("userScore"))!==0&&(this.set("userScore",a),DISQUS.api.call("threads/vote.json",
{data:{thread:this.id,vote:a},method:"POST",success:function(d){d.response.id&&(c.votes.get(d.response.id)||c.votes.add({id:d.response.id,score:a}))}}))},broadcastPostCount:function(){i.sendGlobalMessage("lounge.updateCounter",{count:this.get("posts")})},fetch:function(a){var c=this,d=c.attributes,a=a||{};DISQUS.api.call("threads/details.json",{data:{thread:d.identifier?"ident:"+d.identifier:"link:"+d.url,forum:d.forum},success:function(d){c.set(d.response);a.success&&a.success()},error:function(){DISQUS.debug?
c.save({},{success:a.success}):console.log("Couldn't find thread; not creating in production.")}})},_toggleState:function(a,c){c||(c={});var d=a?"open.json":"close.json";this.set("isClosed",!a);DISQUS.api.call("threads/"+d,{method:"POST",data:{thread:this.id},success:c.success,error:c.error})},open:function(a){this._toggleState(!0,a)},close:function(a){this._toggleState(!1,a)},sync:function(){var a=this,c=a.attributes;DISQUS.api.call("threads/create.json",{data:{title:c.title,forum:c.forum,identifier:c.identifier,
url:c.url},method:"POST",success:function(c){a.set(c.response)}})},incrementPostCount:function(a){this.set("posts",this.get("posts")+a)},isModerator:function(a){if(this.moderators)return a=a instanceof j||_.isObject(a)?a.id:a,a=parseInt(a,10),_(this.moderators).contains(a)},subscribe:function(a,c){var a=a!==!1,d=this.get("userSubscription");if(d!=a){a?this.set("userSubscription",c||!0):this.set("userSubscription",!1);var e={thread:this.id};if(c)e.email=c;else if(!a&&typeof d==="string")e.email=d;
DISQUS.api.call("threads/"+(a?"subscribe.json":"unsubscribe.json"),{data:e,method:"POST"})}},relatedIds:function(){var a=this.get("forum");_.isObject(a);return{forum:this.get("forum"),thread:this.id}},twitterText:function(a){var a=140-(a.length+1),c=DISQUS.lounge.utils.htmlDecode(this.get("title"));return c=DISQUS.lounge.utils.niceTruncate(c,a)},url:function(){var a=this.get("url")||this.get("link");if(!a&&this.currentUrl)a=this.currentUrl;return a}}),a=k.extend({defaults:_.extend({postsInInterval:0,
topPost:null},k.prototype.defaults)}),h=Backbone.Model.extend({defaults:function(){return{createdAt:moment().format(DISQUS.ISO_8601),dislikes:0,isApproved:!0,isDeleted:!1,isEdited:!1,isFlagged:!1,isHighlighted:!1,isRealtime:!1,isImmediateReply:!1,isMinimized:null,message:null,raw_message:null,likes:0,media:[],points:0,depth:0,userScore:0}},initialize:function(){this.votes=new d.VoteCollection;this.usersTyping=new d.TypingUserCollection},set:function(a,c,d){if(a&&typeof a!=="string"&&a.author)this.author=
new e(j,a.author),delete a.author;return Backbone.Model.prototype.set.call(this,a,c,d)},messageText:function(){var a=this.get("message");return _.strip(a)},relatedIds:function(){var a=this.get("forum");if(_.isObject(a))a=a.id;var c=this.get("thread");if(_.isObject(c))c=c.id;return{forum:a,thread:c,post:this.id}},twitterText:function(a){var c=140,d;d=this.author.get("name")||this.author.get("username");c-=d.length+3;c-=a.length+1;c-=2;a=this.messageText();a=DISQUS.lounge.utils.niceTruncate(a,c);return'"'+
a+'" \u2014 '+d},getRelativeCreatedAt:function(){var a=this.get("createdAt");if(a)return a=DISQUS.assureOffset(a),moment(a,DISQUS.ISO_8601).fromNow()},toJSON:function(){var a=Backbone.Model.prototype.toJSON.call(this);a.isMinimized=this.get("isMinimized")===!1?!1:!this.get("isApproved");if(this.author)a.author=this.author.toJSON();a.relativeCreatedAt=this.getRelativeCreatedAt();return a},validate:function(a){if(!this.id&&!a.id){if(_.isString(a.raw_message)){if(a.raw_message==="")return"Comments can't be blank.";
if(a.raw_message.length<2)return"Comments must have at least 2 characters."}if(a.author_email===""&&a.author_name==="")return"Please sign in or enter a name and email address.";else if(a.author_email===""||a.author_name==="")return"Please enter both a name and email address.";if(_.isString(a.author_email)&&!f.validateEmail(a.author_email))return"Invalid email address format."}},report:function(){this.set("isFlagged",!0);DISQUS.api.call("posts/report.json",{data:{post:this.id},method:"POST"})},_vote:function(a,
c){function d(a){f.set("likes",f.get("likes")+a)}function e(a){f.set("dislikes",f.get("dislikes")+a)}var f=this,p=a-c;if(p===0)return p;f.set("points",f.get("points")+p);a>0?(d(a),e(c)):a<0?(e(-a),d(-c)):c>0?d(-c):e(c);return p},vote:function(a){var c=this;c._vote(a,c.get("userScore"))!==0&&(c.set("userScore",a),DISQUS.api.call("posts/vote.json",{data:{post:c.id,vote:a},method:"POST",success:function(a){c.votes.add({id:a.response.id})}}))},_delete:function(){this.set({isApproved:!1,isDeleted:!0});
DISQUS.api.call("posts/remove.json",{data:{post:this.id},method:"POST"})},spam:function(){this.set({isApproved:!1,isDeleted:!0,isSpam:!0});this.trigger("spam");DISQUS.api.call("posts/spam.json",{data:{post:this.id},method:"POST"})},_create:function(a,c){var d=this,e=a.attributes,f={thread:e.thread,message:e.raw_message};if(e.recaptcha_challenge_field)f.recaptcha_challenge_field=e.recaptcha_challenge_field,f.recaptcha_response_field=e.recaptcha_response_field;if(e.parent)f.parent=e.parent;if(e.author_name)f.author_name=
e.author_name,f.author_email=e.author_email;DISQUS.api.call("posts/create.json",{data:f,method:"POST",success:function(a){d.set(a.response);c.success&&c.success()},error:c.error})},_update:function(a,c){var d=this,e=a.attributes;DISQUS.api.call("posts/update.json",{data:{post:e.id,message:e.raw_message},method:"POST",success:function(a){d.set(a.response);c.success&&c.success()},error:c.error})},_read:function(a,c){var d=this,c=c||{};DISQUS.api.call("posts/details.json",{data:{post:d.id},method:"GET",
success:function(a){d.set(a.response);c.success&&c.success()},error:c.error})},sync:function(a,c,d){var d=d||{},e=d.error;if(e)d.error=function(a){e(JSON.parse(a.responseText||"{}"))};switch(a){case "create":this._create(c,d);break;case "update":this._update(c,d);break;case "delete":this._delete();break;case "read":this._read(c,d)}}});e.addType("Post",h);var o=Backbone.Model.extend({defaults:{userId:null,message:null,parentId:null,immedReply:!1},initialize:function(){this.set("createdAt",moment().format(DISQUS.ISO_8601))},
getVisibleParent:function(a){for(var c=this,d;c.get("parentId");){if(d=a.posts.get(c.get("parentId")))return d;c=a.queue.get(c.get("parentId"));if(!c)break}return null},toPost:function(a){var c=a.posts.get(this.get("parentId")),c=c?c.get("depth")+1:0,c=new e(h,{id:this.id,thread:a.id,message:this.get("message"),parent:this.get("parentId"),depth:c,createdAt:this.get("createdAt"),isRealtime:!0,isImmediateReply:this.get("immedReply")});c.author=a.users.get(this.get("userId"));return c}}),l=Backbone.Model.extend({defaults:{typing:!0},
initialize:function(){this.createdAt=moment()}}),r=Backbone.Model.extend({defaults:{about:null,avatar:{cache:DISQUS.urls.media+"/images/noavatar92.png",permalink:DISQUS.urls.media+"/images/noavatar92.png"},connections:{},email:null,emailHash:null,isAnonymous:!0,isFollowedBy:!1,isFollowing:!1,joinedAt:null,name:null,profileUrl:null,url:null,username:null,numPosts:null,numFollowing:null,numFollowers:null,numLikesReceived:null},hasValidAvatar:function(a){if(!a)a=this.attributes;return(a=a.avatar)&&a.cache&&
a.permalink},validate:function(a){if(!this.hasValidAvatar(a))return"None of the avatar related properties can be null, undefined or empty on User models."},toJSON:function(){var a=Backbone.Model.prototype.toJSON.apply(this,arguments);a.thread={};if(!this.hasValidAvatar())a.avatar=this.defaults.avatar;return a}}),q=r.extend({idAttribute:"emailHash"});e.addType("AnonUser",q);var j=r.extend({fetch:function(a){var c=this,a=a||{};DISQUS.api.call("users/details.json",{data:c.id?{user:c.id}:{},success:function(d){d=
d.response;c.set(d);a.success&&a.success(d);a.complete&&a.complete(d)},error:function(c){a.error&&a.error(c);a.complete&&a.complete(c)}})},toJSON:function(){var a=r.prototype.toJSON.call(this),c=this.collection&&this.collection.thread;a.thread.canModerate=!!c&&c.isModerator(this);return a},follow:function(){var a=this;DISQUS.api.call("users/follow.json",{data:{target:this.id},method:"POST",success:function(){a.set("isFollowing",!0)}})},unfollow:function(){var a=this;DISQUS.api.call("users/unfollow.json",
{data:{target:this.id},method:"POST",success:function(){a.set("isFollowing",!1)}})}});e.addType("User",j);var m=j.extend({defaults:_.extend({numPosts:0},j.prototype.defaults)}),x=function(){var a=_.extend({id:0,user:new e(q),canReply:!0,canModerate:!1,mustVerifyEmail:!1,_eventProxy:function(){a.trigger.apply(a,arguments)},_setProxy:function(){a.user.on("all",a._eventProxy)},_clearProxy:function(){a.user.off("all",a._eventProxy)},_setUser:function(c){a._clearProxy();a.user=c;a._setProxy();a.trigger("change:id",
c)},isRegistered:function(){return a.user instanceof j},isAnonymous:function(){return a.user instanceof q},toJSON:function(){var c=a.user.toJSON.apply(a.user,arguments);c.thread.canReply=a.canReply;if(!c.thread.canModerate)c.thread.canModerate=a.canModerate;return c},fetch:function(c){var c=c||{},d={thread:c.thread.id,post:c.thread.posts.pluck("id")};d["_"+(new Date).getTime()]=1;DISQUS.api.call("embed/threadDetails.json",{data:d,success:function(d){var d=d.response,f={};d.user&&_.extend(f,d.user,
{votes:d.votes});f.id&&(_.extend(a,d.session),a._setUser(new e(j,f)),c.thread.users.add(a.user));c.success&&c.success(d);c.complete&&c.complete(d)},error:function(a){c.error&&c.error(a);c.complete&&c.complete(a)}})},register:function(c,d){DISQUS.api.call("internal/users/register.json",{secure:!0,data:{display_name:c.name,email:c.email},method:"POST",success:function(c){a._setUser(new e(j,c.response))},error:d.error||function(){}})},logout:function(){DISQUS.api.call("internal/users/logout.json",{method:"POST",
success:function(){a._setUser(new e(q))}})}},Backbone.Events);return a}(),w=Backbone.Model.extend({defaults:{score:0}}),p=Backbone.Model.extend({defaults:{score:0}}),y=Backbone.Model.extend({defaults:function(){return{object:{},type:"",createdAt:moment().format(DISQUS.ISO_8601)}},toJSON:function(){var a=Backbone.Model.prototype.toJSON.call(this),c=DISQUS.assureOffset(this.get("createdAt"));a.relativeCreatedAt=moment(c,DISQUS.ISO_8601).fromNow();return a}}),z=Backbone.Model.extend({defaults:function(){return{sender:"",
timestamp:moment().valueOf(),type:0,formatted:"",theme:""}}}),F=Backbone.Model.extend({defaults:{enabled:!1}}),v=Backbone.Model.extend({defaults:{thread:null,forum:null,body:null,service:{url:null,name:null},url:null,title:null},set:function(a,c){if(a&&typeof a!=="string"){if(a.author)this.author=new e(a.author.id?j:q,a.author),delete a.author;if(a.createdAt)a.relativeCreatedAt=moment(DISQUS.assureOffset(a.createdAt),DISQUS.ISO_8601).fromNow()}return Backbone.Model.prototype.set.call(this,a,c)},toJSON:function(){var a=
Backbone.Model.prototype.toJSON.call(this);if(this.author)a.author=this.author.toJSON();return a},destroy:function(){DISQUS.api.call("reactions/remove.json",{data:{reaction:this.id,forum:this.get("forum")},method:"POST"})}});return{UniqueModel:e,Forum:c,Thread:k,TopThread:a,Post:h,QueuedPost:o,Reaction:v,TypingUser:l,User:j,AnonUser:q,Session:x,TopUser:m,Vote:w,ThreadVote:p,Notification:z,ActivityItem:y,Switch:F}});
DISQUS.define("lounge.collections",function(){var e=DISQUS.use("lounge.models"),d=DISQUS.use("lounge.utils"),f=Backbone.Collection.extend({model:e.ThreadVote}),i=Backbone.Collection.extend({model:_.bind(e.UniqueModel,{},e.User),initialize:function(a,c){Backbone.Collection.prototype.initialize.apply(this,arguments);this.thread=c&&c.thread}}),c=Backbone.Collection.extend({model:e.Notification,url:DISQUS.api.getURL("messagesx/unread"),initialize:function(a,c){this.user=c.user},fetch:function(){Backbone.Collection.prototype.fetch.call(this,
{data:{user:"username:"+this.user.get("username")}})},markRead:function(){var a=this,c=_.pluck(a.models,"id");DISQUS.api.call("messagesx/markRead.json",{data:{messages:c},method:"POST",success:function(){a.remove(c)}})},parse:function(a){return a.response.messages}}),k=Backbone.Collection.extend({model:e.Vote}),a=Backbone.Collection.extend({initialize:function(a,c){this.cursor=c.cursor||{}},fetch:function(a){a.data=_.extend({},a.data||{},{cursor:a.cursor||""});return Backbone.Collection.prototype.fetch.call(this,
a)},more:function(a){this.cursor.hasNext?this.fetch(_.extend(a||{},{add:!0,cursor:this.cursor.next})):a.error&&a.error()},parse:function(a){this.cursor=a.cursor;return Backbone.Collection.prototype.parse.call(this,a)}}),h=a.extend({model:_.bind(e.UniqueModel,{},e.Post),url:DISQUS.api.getURL("threads/listPostsThreaded"),initialize:function(c,e){a.prototype.initialize.apply(this,arguments);this.thread=e.thread;this.order=d.cookies.read("disqus.order")||"popular"},fetch:function(c){c=c||{};this.order===
"popular"?d.cookies.erase("disqus.order"):d.cookies.create("disqus.order",this.order);c=_.extend(c,{data:{limit:h.PAGINATION_LIMIT,thread:this.thread.id,forum:this.thread.get("forum"),order:this.order}});return a.prototype.fetch.call(this,c)},add:function(a,c){_.isArray(a)||(a=[a]);for(var d=[],e=0;e<a.length;e++)this.get(a[e].id)||d.push(a[e]);Backbone.Collection.prototype.add.call(this,d,c)}},{PAGINATION_LIMIT:50}),o=Backbone.Collection.extend({model:e.QueuedPost,initialize:function(a,c){var d=
this;d.thread=c.thread;d.counters={comments:0,replies:{}};d.bind("add",function(a){var c=a.getVisibleParent(d.thread);c?(d.counters.replies[c.id]?d.counters.replies[c.id]+=1:d.counters.replies[c.id]=1,c.id==a.get("parentId")&&a.set("immedReply",!0)):d.counters.comments+=1})},comparator:function(a){return parseInt(a.get("id"),10)},isDescendant:function(a,c){var b;var d=a.get("parentId"),d=d?this.get(d):null,e={};for(_.each(c,function(a){e[a]=!0});d;){if(e[d.get("id")]===!0)return!0;b=(d=d.get("parentId"))?
this.get(d):null,d=b}return!1},drain:function(a){function c(a){var d=[];e.each(function(a){a.get("parentId")===null&&d.push(a.get("id"))});e.reset(e.filter(function(c){if(c.get("parentId")!==null&&!e.isDescendant(c,d))return c;a(c)}));e.counters.comments=0}function d(c){var f=[],h=[],h=e.filter(function(c){var d=c.getVisibleParent(e.thread);if(!d||d.get("id")!=a)return c;f.push(c)}),f=_.sortBy(f,function(a){return parseInt(a.get("id"),10)});_.each(f,function(a){c(a)});e.reset(h);e.counters.replies[a]=
0}var e=this;return(a?d:c)(function(a){e.thread.posts.add(a.toPost(e.thread))})}}),l=Backbone.Collection.extend({model:e.Switch,parse:function(a){return _.map(a,function(a,c){return{id:c,enabled:a}})},enabled:function(a){return(a=this.get(a))?a.get("enabled"):!1}}),r=Backbone.Collection.extend({models:e.TypingUser,initialize:function(){var a=this;a.gc=null;a.bind("add remove reset",function(){var c=a.count();if(c>0&&a.gc===null)a.gc=setInterval(_.bind(a.cleanup,a),6E4);else if(c<=0&&a.gc!==null)clearInterval(a.gc),
a.gc=null},a)},count:function(){var a=0;this.each(function(c){a+=c.get("typing")?1:-1});return a},cleanup:function(){var a=moment();this.reset(this.filter(function(c){return c.createdAt.diff(a,"minutes")>5}))}}),q=Backbone.Collection.extend({model:e.ActivityItem,url:DISQUS.api.getURL("users/listActivity"),initialize:function(a,c){this.user=c.user;this.include=c.include||null},fetch:function(){var a={user:"username:"+this.user.get("username")};if(this.include)a.include=this.include;Backbone.Collection.prototype.fetch.call(this,
{data:a})}}),j=Backbone.Collection.extend({model:_.bind(e.UniqueModel,{},e.Post),url:DISQUS.api.getURL("users/listPostActivity")}),m=Backbone.Collection.extend({model:e.TopThread,url:DISQUS.api.getURL("threads/listPopular"),initialize:function(a,c){this.forum=c.forum;this.limit=c.limit},add:function(a,c){_.isArray(a)||(a=[a]);var d=[];_.each(a,function(a){a.title.match(/^http/i)||d.push(a)});Backbone.Collection.prototype.add.call(this,d,c)},fetch:function(){Backbone.Collection.prototype.fetch.call(this,
{data:{forum:this.forum,limit:this.limit,interval:"7d",with_top_post:!0}})}}),x=Backbone.Collection.extend({model:e.TopUser,url:DISQUS.api.getURL("forums/listMostActiveUsers"),initialize:function(a,c){this.forum=c.forum;this.limit=c.limit;this.discardLowRep=c.discardLowRep},fetch:function(){Backbone.Collection.prototype.fetch.call(this,{data:{forum:this.forum,limit:this.limit}})},parse:function(a){if(!this.discardLowRep)return a.response;return _.filter(a.response,function(a){if(parseFloat(a.rep)>
0.7)return a})}}),w=a.extend({model:e.Reaction,url:DISQUS.api.getURL("threads/listReactions"),initialize:function(a,c){this.thread=c.thread},fetch:function(c){c=c||{};c=_.extend(c,{data:{limit:w.PAGINATION_LIMIT,thread:this.thread.id}});return a.prototype.fetch.call(this,c)}},{PAGINATION_LIMIT:20});return{UserCollection:i,PostCollection:h,ReactionsCollection:w,TypingUserCollection:r,TopUserCollection:x,TopThreadCollection:m,VoteCollection:k,ThreadVoteCollection:f,ActivityCollection:q,PostActivityCollection:j,
NotificationCollection:c,QueuedPostCollection:o,SwitchCollection:l}});
DISQUS.define("lounge.views",function(){function e(b){return(b=b&&b.match(/discovery\-(\w+)/))&&b[1]}function d(b){return function(a){a&&a.preventDefault&&a.preventDefault();b.apply(this,arguments)}}var f=DISQUS.use("lounge.models"),i=DISQUS.use("lounge.collections"),c=DISQUS.use("lounge.utils"),k=DISQUS.use("lounge.realtime"),a=DISQUS.use("Bus"),h=DISQUS.use("JSON"),o,l=1,r={_getShortUrl:function(b){var a=this,c=this._shareUrl(),d=c,c=_.extend({url:c,source:"disqus_embed_next"},this.model.relatedIds());
DISQUS.api.call("shortener/create.json",{method:"POST",data:c,timeout:5E3,success:function(b){if(b.code===0)d=b.response.url},complete:function(){b.call(a,d)}})},_shareWaitPopup:function(b){var a=DISQUS.serialize(DISQUS.urls.loading,{img:DISQUS.urls.themeUrl+"/img/loader.gif"});return window.open(a,"_blank",b||"width=550,height=520")},extractService:function(b){b=$(b);b=b.is("[data-action^=share]")&&b||b.closest("[data-action^=share]");b=(b.attr("data-action")||":").split(":")[1];if(this.sharers[b])return b},
share:function(b){this.sharers[b].call(this)},sharers:{twitter:function(){var b=this._shareWaitPopup();this._getShortUrl(function(a){b.location=DISQUS.serialize("https://twitter.com/intent/tweet",{url:a,text:this.model.twitterText(a)})})},facebook:function(){var b=this._shareWaitPopup("width=655,height=352");this._getShortUrl(function(a){b.location=DISQUS.serialize("https://www.facebook.com/sharer.php",{u:a})})}}},q={alert:function(b,a){a?_.isString(a)&&(a={type:a}):a={};this._alert&&this._alert.dismiss();
var c=this._alert=new O(_.extend({message:b},a));this.updateDom(function(){c.render().$el.prependTo($("#form")[0])});return c}},j=Backbone.View.extend({events:{"click [data-action=auth-twitter]":"authTwitter","click [data-action=auth-facebook]":"authFacebook","click [data-action=auth-google]":"authGoogle","click [data-action=auth-disqus]":"authDisqus","click [data-action=auth-sso]":"authSSO","click [data-action=verify-email]":"verifyEmail","click [data-action=audiencesync]":"audienceSync","click [data-action=profile]":"handleShowProfile",
"click [data-action=sort]":"handleSort","click [data-action=logout]":"logout","click [data-action=close-thread]":"closeThread","click [data-action=open-thread]":"openThread","click [data-action=debug]":"renderDebugInfo"},STREAMING_MAX_VISIBLE:250,initialize:function(b){o=this;b=b||{};b=b.jsonData||{};this.initialData=b.response||{};if(c.extract(b,"response.forum.id"))DISQUS.urls.moderate=c.updateURL(DISQUS.urls.moderate,{hostname:b.response.forum.id+"."});this.theme=c.extract(this.initialData,"theme.base")||
{};this.session=f.Session;this.forum=new f.Forum;this.thread=new f.Thread(null,{forum:this.forum,postCursor:b.cursor,moderators:(this.initialData.thread||{}).moderators});this.posts=this.thread.posts;this.switches=new i.SwitchCollection;this.realtimePool=null;this.renderJobs=[];this.states={templateReady:!1,realtimeIndicatorsCreated:!1,pollingRunning:!1,ravenConfigured:!1,inViewport:!1,streamingPaused:!1};a.bind("window.inViewport",function(){this.states.inViewport=!0;this.trigger("inViewport")},
this);a.bind("window.scrollOffViewport",function(){this.states.inViewport=!1},this);a.bind("switches.changed",function(b){this.switches.reset(this.switches.parse(b));if(!this.states.ravenConfigured&&this.switches.enabled("next_raven"))Raven.config({servers:["http://disqus.com/raven/api/store/"],logger:"javascript.next",ignoreErrors:["Script error."]}),window.onerror=Raven.process,DISQUS.api.defaults({error:function(b){Raven.captureMessage({name:"API call failed.",message:b})}}),this.states.ravenConfigured=
!0;if(!this.switches.enabled("next_lazy_embed")||this.states.inViewport)this.initializeSession();else this.on("inViewport",this.initializeSession,this)},this);this.switches.on("reset",function(){var b=function(){if(!this.states.templateReady)return!1;return this.thread&&this.thread.id};DISQUS.defer(_.bind(b,this),_.bind(this.poll,this));DISQUS.defer(_.bind(b,this),_.bind(this.renderThreadVotes,this,this.thread))},this);a.bind("init",function(b){o.bootstrap(b)});b={};if(typeof this.initialData==="object"&&
!_.isEmpty(this.initialData))b.thread={id:this.initialData.thread.id};a.sendHostMessage("ready",b)},_templateReady:function(){this.states.templateReady=!0;this.renderLayout();this.trigger("templateReady")},bootstrap:function(b){var g=this;g.config=b||{};var d={};if(b.apiKey)d["X-Disqus-Publisher-API-Key"]=b.apiKey;if(b.remoteAuthS3)d["X-Disqus-Remote-Auth"]=b.remoteAuthS3;_.isEmpty(d)||DISQUS.api.defaults({headers:d});b.anchorColor&&function(){var a=c.escapeColor(b.anchorColor);c.addStylesheetRules([[".publisher-anchor-color a",
["color",a,!0]],["a.publisher-anchor-color",["color",a,!0]],[".publisher-anchor-hover a:hover",["color",a,!0]],["a.publisher-anchor-hover:hover",["color",a,!0]],[".active .publisher-nav-color:after",["background",a,!0]],[".media-preview .active.publisher-border-color",["border-color",a,!0]]])}();d=$("body");b.serif&&d.addClass("serif");(function(){var a=document.createElement("base");a.target="_parent";a.href=b.referrer;$("head").append(a)})();if(b.referrer)g.thread.currentUrl=b.referrer;if(b.width)document.body.style.width=
b.width+"px";if(b.permalink)g.on("postsRendered",_.once(function(){g.scrollToPost(b.permalink)}));if(b.sso)DISQUS.templateGlobals.sso=b.sso;var f=this.theme.js,B=this.theme.css;b.themeUrl&&(f=b.themeUrl+"/theme.js",B=b.themeUrl+"/theme.css");DISQUS.urls.themeUrl=b.themeUrl||DISQUS.urls.media+"/img/next/";var h=this.initialData.forum.language||"en";this.language=h;f=[f];h!=="en"&&f.push(DISQUS.urls.media+"/build/lang/"+h+".js");f=_.map(f,function(b){return DISQUS.serialize("js!"+b,null,DISQUS.debug)});
f.push(DISQUS.serialize("css!"+B,null,DISQUS.debug));curl(f,_.bind(this._templateReady,this));g.bind("templateReady",g.renderForm,g);g.bind("templateReady",g.updatePostCount,g);g.bind("templateReady",g.initCommunity,g);g.bind("templateReady",g.initReactions,g);g.bind("templateReady",g.initUserMenu,g);g.bind("templateReady",g.renderStreamingToggle,g);g.renderBindings([g.thread,"change:likes",g.updateThreadVotes],[g.thread,"change:userScore",g.updateThreadUserScore],[g.thread,"change:posts",g.updatePostCount],
[g.thread,"change:userSubscription",g.renderThreadVotes],[g.thread.posts,"reset",g.redrawPosts],[g.thread.posts,"add",g.addPosts],[g.thread.posts,"remove",g.removePost],[g.thread.posts,"reset add",g.toggleLoadMorePosts],[g.thread.posts,"reset add",g.toggleNoPosts],[g.thread.posts,"reset",function(){g.poll()}],[g.thread.reactions,"reset add",g.toggleLoadMoreReactions],[g.session,"change:id",g.updateThreadSessionData],[g.session,"change:id",g.initDashboard],[g.session,"change:id",g.renderThreadVotes],
[g.session,"change:id",g.audienceSyncToggle]);g.bind("scroll",function(b){g.position=b;if(g.currentSection==="conversation")g.conversationPosition=b});g.bind("scrollOffViewport",function(){g.states.realtimeIndicatorsCreated&&g.currentSection==="conversation"&&(a.sendHostMessage("realtime.hideNorth"),a.sendHostMessage("realtime.hideSouth"))});g.bind("scroll",function(b){if(g.states.realtimeIndicatorsCreated&&g.currentSection==="conversation"){var c=_.union([this.queueView],_.values(this.postViews)),
d=0,e=0;_.each(c,function(a){if(a&&!a.getDirection)a=a.queueView;if(a&&!(a.options.count<=0)){var c=a.getDirection(b);c===1?d+=a.options.count:c===-1&&(e+=a.options.count)}});var c="realtime.hideNorth",u;d>0&&(c="realtime.showNorth",u=DISQUS.renderBlock("realtimeIndicatorText",{num:d,orientation:"north"}));a.sendHostMessage(c,u);c="realtime.hideSouth";u=void 0;e>0&&(u=DISQUS.renderBlock("realtimeIndicatorText",{num:e,orientation:"south"}),c="realtime.showSouth");a.sendHostMessage(c,u)}},g);a.bind("window.hashchange",
function(b){if(e(b))return void a.sendHostMessage("reset");(b=b&&b.match(/comment\-([0-9]+)/))&&g.scrollToPost(b[1])});a.bind("window.scroll",function(b){g.trigger("scroll",b)});a.bind("window.scrollOffViewport",function(){g.trigger("scrollOffViewport")});a.bind("window.resize",g.resize,g);a.bind("realtime.click",function(b){a.sendHostMessage("realtime.hide"+(b==="north"?"North":"South"));var c=_.union([g],_.toArray(g.postViews)),d,e,c=_.filter(c,function(a){a=a.queueView;if(!a||a.options.count<=
0)return!1;var c=b==="north"?1:-1;if(a.getDirection(g.position)!==c)return!1;return!0}),c=_.sortBy(c,function(b){if(b===g)return 0;return b.offset.top}),c=b==="north"?_.last(c):_.first(c);d=c.queueView;c===g?(e=0,d.model.queue.drain(),d.setCount(d.model.queue.length)):(e=c.offset.top-100,d.options.thread.queue.drain(d.model.id),d.setCount(d.options.thread.queue.length));var u=function(){a.sendHostMessage("scrollTo",{top:e});j.getInstance().off("domReflow",u)};j.getInstance().on("domReflow",u)});g.thread.queue.bind("add reset",
g.toggleRealtimeNotifications,g);g.forum.set(this.initialData.forum);g.thread.set(this.initialData.thread);g.posts.reset(this.initialData.posts);if(g.forum.get("settings").ssoRequired)g.session.canReply=!1;g.getColorScheme()==="dark"&&d.addClass("dark");a.bind("auth:success",function(b){b&&b.sessionId&&DISQUS.api.defaults({headers:{"X-Sessionid":b.sessionId}});g.refreshSession()});a.bind("audiencesync:grant",function(){if(this._alert)this._alert.remove(),this._alert=null},this);_.delay(function G(){g.postViews&&
!(_.size(g.postViews)<1)&&(_.invoke(g.postViews,"updateRelativeTime"),_.delay(G,6E4))},6E4);g.currentSection="conversation";g.thread.on("create",function(b){a.sendHostMessage("posts.create",b.toJSON())});g.initialized=!0},initializeSession:function(){var b=this;(!b.forum.get("settings").ssoRequired||b.config.remoteAuthS3)&&b.session.fetch({thread:b.thread,complete:function(a){b.session.trigger("identify");b.session.on("authenticated",b.refreshSession,b);var d=c.extract(a,"theme.discovery");d&&b.initDiscovery(d);
d=j.getInstance();c.extract(a,"session.isReadOnly")&&d.alert("The Disqus comment system is temporarily in maintenance mode. You can still read comments during this time, however posting comments and other actions are temporarily delayed.")}})},refreshSession:function(){this.session.fetch({thread:this.thread})},initRealtime:function(){var b={width:$("html").width()+"px",position:"fixed"},c={contents:DISQUS.renderBlock("realtimeIndicator",{orientation:"north"}),styles:{top:"0"}},d={contents:DISQUS.renderBlock("realtimeIndicator",
{orientation:"south"}),styles:{bottom:"0"}};_.defaults(c.styles,b);_.defaults(d.styles,b);a.sendHostMessage("realtime.init",{north:c,south:d});this.states.realtimeIndicatorsCreated=!0},insertStreamingComments:_.throttle(function(){var b=this.thread.queue;b.drain();_.each(b.counters.replies,function(a,c){b.drain(c)})},1E3),getColorScheme:function(){var b=this.forum.get("settings"),a=this.config.colorScheme||"light";b.overrideStyles&&(a=b.darkTheme?"dark":"light");return a},toggleRealtimeNotifications:function(){var b=
this,c=b.thread.queue;b.updateDom(function(){_.defer(function(){a.sendHostMessage("fakeScroll")});if(!c.length)return void $("[data-role=realtime-notification]").hide();if(b.thread.get("hasStreaming"))return void b.insertStreamingComments();var d=b.queueView||new C({model:b.thread,el:b.$el.find("button[data-role=realtime-notification]")});b.queueView=d;d.setCount(c.counters.comments);d.render();_.each(c.counters.replies,function(a,c){var g=b.thread.posts.get(c);if(g){var d=b.postViews[g.cid],e=d.queueView;
if(!e)e=new N({thread:b.thread,postView:d,model:g,el:d.$el.find("[data-role=realtime-notification:"+c+"] a")}),d.queueView=e;e.setCount(a);e.render()}})})},renderDebugInfo:d(function(){if(this.session.user.get("isGlobalAdmin")){var b=new P({Shortname:this.thread.get("forum"),"Thread ID":this.thread.get("id"),"Thread slug":this.thread.get("slug"),"Anchor color":c.escapeColor(this.config.anchorColor)});b.render();this.updateDom(function(){var a=document.body;a.insertBefore(b.el,a.firstChild)})}}),scrollToPost:function(b,
c,d){var e=this;e.currentSection!=="conversation"&&(d=!0);e.mainNav.navTo("conversation");var B=e.$el.find("#post-"+b);B.length?(c=c||0,_.delay(function(){a.sendHostMessage("scrollTo",{top:B.offset().top+c,force:d||null})},100)):DISQUS.api.call("posts/getContext.json",{method:"GET",data:{post:b},success:function(a){a=_.filter(a.response,function(b){return b.thread==e.thread.get("id")});a.length!==0&&(_.each(a,function(b){e.thread.posts.add(new f.UniqueModel(f.Post,b))}),e.on("domReflow",function G(){e.off("domReflow",
G);e.scrollToPost(b,c,d)}))}})},updateThreadSessionData:function(b){b&&(b.get("thread")&&this.thread.set(b.get("thread")),(b=b.get("votes"))&&typeof b==="object"&&_.each(b,function(b,a){var c=this.posts.get(a);c&&c.set("userScore",b)},this))},initDashboard:function(){var b=$("#main-nav [data-nav=dashboard]");if(this.session.isAnonymous())return b.hide();b.show();this.notifications=new i.NotificationCollection(null,{user:this.session.user});this.notifications.fetch();this.notificationCount=new L({el:b.find("[data-role=notification-count]")[0],
collection:this.notifications});this.dashboard=new Q({el:$("#dashboard")[0],user:this.session.user,notifications:this.notifications})},initCommunity:function(){this.community=new R({el:document.getElementById("community"),forum:this.forum})},initReactions:function(){this.reactions=new da({el:$("#reaction-list")[0],collection:this.thread.reactions,thread:this.thread,session:this.session});this.forum.get("settings").hasReactions&&$("#global-nav").length===0&&(this.thread.reactions.on("reset",function(){$("#reactions").show()}),
this.thread.reactions.fetch())},_getLogoutUrl:function(){return this.config.sso&&this.session.user.get("user_type")==="sso"?this.config.sso.logout:DISQUS.urls.logout},initUserMenu:function(){var b=this.userMenu=new w({el:this.$el.find("[data-role=logout]")[0],session:this.session,thread:this.thread,showLogin:!this.forum.get("settings").ssoRequired,logoutUrl:this._getLogoutUrl(),referrerUrl:this.config.referrer});this.session.on("change:id",function(){b.logoutUrl=this._getLogoutUrl();b.render()},this);
this.thread.on("change:isClosed",this.render,this);b.render()},initDiscovery:function(b){function a(b){if(!i){if(!d.switches.length)return void d.switches.on("reset",function ca(){a(b);d.switches.off("reset",ca)});if(d.switches.enabled("discovery_next"))try{DISQUS.runThemeScript&&(DISQUS.runThemeScript(),i=!0),DISQUS.discovery.init(_.extend({},d.config,{variant:h,thread:d.initialData.thread,forum:d.initialData.forum,switches:d.switches}),b)}catch(c){return void Raven.captureMessage({name:"There is a bug in Discovery JS. Variant: "+
h,message:c})}}}function c(b){b.on("allSubviewsRendered",d.updateDom,d);b.on("resize",d.updateDom,d);d.updateDom(function(){var a="#discovery";if(h=="top"||h=="top2")a+="-top";b.render();$(a).append(b.$el)})}var d=this;if(!d.states.templateReady)return void d.on("templateReady",function ba(){d.initDiscovery(b);d.off("templateReady",ba)});var f=e(d.config.parentWindowHash);f&&(b={js:b.js.replace(RegExp(b.name+"\\.js$"),f+".js"),css:b.css.replace(RegExp(b.name+"\\.css$"),f+".css"),name:f});var h,i=
!1;h=b.name;DISQUS.requireStylesheet(b.css,{},DISQUS.debug);DISQUS.require(b.js,{},DISQUS.debug,function(){a(c)});d.initDiscovery=function(){}},toggleLoadMorePosts:function(){var b=this.$el.find("#posts [data-role=more]");this.updateDom(function(){b[this.thread.posts.cursor.hasNext?"show":"hide"]()},this)},toggleLoadMoreReactions:function(){var b=this.$el.find("#reactions [data-role=more]");this.updateDom(function(){b[this.thread.reactions.cursor.hasNext?"show":"hide"]()},this)},poll:function(){function b(b){var b=
b.message_body,a=e.thread;if(!e.thread.get("hasStreaming")||!e.states.streamingPaused){if(!b.id)return void DISQUS.logError("RT: no post ID");if(!b.author||!b.author.id)return void DISQUS.logError("RT: no author or author ID");if(!b.author.name||!b.author.email_md5)return void DISQUS.logError("RT: no author name or email hash");if(!b.post||!b.post.message)return void DISQUS.logError("RT: no post message");if(a.posts.get(b.id)||a.queue.get(b.id))return void DISQUS.log("RT: duplicate",b.id);if(b.type!==
"approved"||b.type_prev!==null)return void DISQUS.log("RT: unnaproved",b.id);e.thread.incrementPostCount(1);var c=b.post.parent_post.id;if((c=c!=="0"?c:null)&&!a.posts.get(c)&&!a.queue.get(c))return void DISQUS.log("RT: parent is not on this page",b.id);var g=b.author.id,d=a.users.get(g);d||(d=new f.UniqueModel(f.User,{id:g,name:b.author.name,emailHash:b.author.email_md5,isAnonymous:b.author.id==="0"}),b.author.avatar&&d.set("avatar",{cache:b.author.avatar,permalink:b.author.avatar}),a.users.add(d));
a.queue.add({id:b.id,userId:d.get("id"),parentId:c,message:b.post.message})}}function a(b){var c=b.message_body,g=e.thread.posts.get(c.vote.recipient_post_id);c.id&&c.vote&&!(e.session.user.id&&c.vote.voter_id==e.session.user.id)&&g&&(b=g.votes.get(c.id),b||(b=new f.Vote({id:c.id}),g.votes.add(b)),c=g._vote(c.vote.vote,b.get("score")),c!==0&&b.set("score",c))}function c(b){var a=b.message_body,g=e.thread;a.id&&a.vote&&!(e.session.user.id&&a.vote.voter_id==e.session.user.id)&&(b=g.votes.get(a.id),
b||(b=new f.ThreadVote({id:a.id}),g.votes.add(b)),a=g._vote(a.vote.vote,b.get("score")),a!==0&&b.set("score",a))}function d(b){var a=b.message_body,c=e.thread;a.thread_id==c.id&&a.post.parent_post.id&&(a=c.posts.get(a.post.parent_post.id))&&(a.usersTyping.get(b.firehose_id)||(!(a.usersTyping.count()<=0)||b.typing)&&a.usersTyping.add(new f.TypingUser({id:b.firehose_id,typing:b.typing})))}var e=this,h=e.switches.enabled("next_realtime_overlap");if(e.switches.enabled("next_realtime")&&(window.location.protocol!==
"https:"||e.switches.enabled("next_disable_ssl_realtime"))){if(h){if(e.realtimePool!==null)return}else{if(e.states.pollingRunning)return;e.states.pollingRunning=!0}e.switches.enabled("next_realtime_indicators")&&(e.states.realtimeIndicatorsCreated||e.initRealtime());var i=DISQUS.urls.realertime+"/api/2/thread/"+e.thread.id,j;h?(e.realtimePool=new k.Pool(i),e.realtimePool.on("progress",function(e){_.each(e,function(e){switch(e.message_type){case "Post":b(e);break;case "Vote":a(e);break;case "ThreadVote":c(e);
break;case "IsTyping":d(e)}})}),_.defer(function(){e.realtimePool.run()})):(j=new k.Firehose(i),j.on("success",function(){e.states.pollingRunning=!1;l=1;e.poll()}),j.on("error",function(){l<=120&&(l*=2);e.states.pollingRunning=!1;_.delay(_.bind(e.poll,e),l*1E3)}),j.on("progress",function(e){switch(e.message_type){case "Post":b(e);break;case "Vote":a(e);break;case "ThreadVote":c(e);break;case "IsTyping":d(e)}}),_.defer(function(){j.run()}))}},renderBindings:function(){var b=this;_.each(arguments,function(a){var c=
a[2];a[0].bind(a[1],function(){var a=arguments;b.states.templateReady?c.apply(b,a):b.bind("templateReady",function(){c.apply(b,a)})})})},updateDom:function(){var b=0,a=_.debounce(function(){b++;for(var a,c;this.renderJobs.length;)a=this.renderJobs.shift(),c=a[0],a=a[1],c&&c.call(a);b--;this.resize();this.trigger("domReflow")},0);return function(c,d){b===0?(this.renderJobs.push([c,d]),a.call(this)):(DISQUS.logError("updateDom nested call detected"),c.call(d))}}(),audienceSyncToggle:function(){var b;
this.forum.get("settings").audienceSyncEnabled&&this.session.user.id&&!this.session.audienceSyncVerified&&(b='In order to comment, you must <a href="#" data-action="audiencesync">connect with '+this.forum.get("name")+"</a>.",this.alert(b,{safe:!0}))},renderThreadVotes:_.debounce(function(){var b;this.threadMenu&&this.threadMenu.remove();this.threadMenu=b=new x({thread:this.thread,session:this.session});b.on("subscribe:error",_.bind(this.alert,this,"Please enter a valid e-mail to subscribe.","error"));
b.on("subscribe:true",_.bind(this.alert,this,"You have subscribed to this thread.","success"));b.on("subscribe:false",_.bind(this.alert,this,"You have unsubscribed from this thread.","success"));b.on("vote:up",_.bind(this.trigger,this,"uiAction:threadUpvote"));b.on("vote:down",_.bind(this.trigger,this,"uiAction:threadDownvote"));b.render();this.updateDom(function(){$("#thread-votes").append(b.el)})},200),renderStreamingToggle:function(){var b=this;if(b.thread.get("hasStreaming")&&DISQUS.blocks.realtimeToggleButton){var a=
$(DISQUS.renderBlock("realtimeToggleButton"));$(a).bind("click",function(){b.toggleStreamingRealtime()});b.updateDom(function(){$("#realtime-toggle").empty();$("#realtime-toggle").append(a[0])})}},toggleStreamingRealtime:function(){var b=$("#realtime-toggle a.btn");this.states.streamingPaused?(this.states.streamingPaused=!1,b.addClass("pause")):(this.states.streamingPaused=!0,b.removeClass("pause"))},updateThreadVotes:function(){$("#thread-votes [data-role=like-count]").text(this.thread.get("likes"))},
updateThreadUserScore:function(){var b=this.thread.get("userScore"),a=$("#thread-votes [data-role=vote-button]");a.length?(a.removeClass("upvoted").removeClass("downvoted"),b>0?a.addClass("upvoted"):b<0&&a.addClass("downvoted")):_.defer(_.bind(this.updateThreadUserScore,this))},updatePostCount:function(){$("#post-count").html(DISQUS.renderBlock("postCount",{count:this.thread.get("posts")}))},swapMain:function(b){var c=this,d=this.$el.find("#main-nav [data-nav=conversation]").parent("li");b!=="conversation"?
d.attr("data-dropdown","disabled"):d.attr("data-dropdown","enabled");c.updateDom(function(){c.states.realtimeIndicatorsCreated&&b!="conversation"&&(a.sendHostMessage("realtime.hideNorth"),a.sendHostMessage("realtime.hideSouth"));var d=c[b];d&&!d.isRendered&&(c.freeze(!0),d.on("render:all",_.once(function(){c.freeze(!1)})),d.show());c.$el.find("[data-role=main]").hide();c.$el.find("[data-role=main]#"+b).show();c.prevSection=c.currentSection;c.currentSection=b});c.trigger("uiAction:navigate",b)},returnToConversation:function(){this.mainNav.navTo("conversation");
var b=this.conversationPosition,c=b&&b.pageOffset;c&&this.updateDom(function(){_.delay(function(){a.sendHostMessage("scrollTo",{top:c,relative:"window",force:!0})},100)},this)},setupNavigation:function(){var b=this;b.globalNav=new S({el:b.$el.find("#global-nav")[0]});b.mainNav=new S({el:b.$el.find("#main-nav")[0]});b.globalNav.on("nav",function(a){b.updateDom(function(){var c=b.$el.find("#form"),d=b.$el.find("#main-nav");switch(a){case "conversation":c.show();d.show();b.swapMain(b.prevSection||a);
break;case "reactions":c.hide(),d.hide(),b.swapMain(a)}})});b.mainNav.on("nav",function(a){b.updateDom(function(){b.swapMain(a)})})},renderLayout:function(){function b(b){return function(c){c.preventDefault();var e=$(c.currentTarget);e.addClass("busy");d.thread[b].more({success:function(){e.removeClass("busy")},error:function(){e.removeClass("busy")}});a.sendHostMessage([b,".paginate"].join(""))}}var d=this;d.setElement($(DISQUS.renderBlock("layout",{thread:_.extend(d.thread.toJSON(),{showReactions:d.forum.get("settings").hasReactions}),
order:d.thread.posts.order,showFooter:!0})).appendTo("body"));var e=d.$el;d.setupNavigation();_.each(["posts","reactions"],function(a){e.delegate("[data-action=more-"+a+"]","click",b(a))});d.resize();a.sendHostMessage("mainViewRendered");var f=c.extract(d,"initialData.theme.discovery");f&&d.initDiscovery(f)},renderForm:function(){if(this.thread.get("isClosed"))return void this.alert("Comments for this thread are now closed.");if(!this.session.canReply)return void this.session.on("change:id",function u(){this.session.off("change:id",
u);this.renderForm()},this);var b=new v({thread:this.thread,session:this.session});b.render();this.updateDom(function(){$("#form").prepend(b.el);b.resize()},this);this.resize()},toggleNoPosts:function(){this.updateDom(function(){var b=this.thread.posts.models;$("#no-posts")[b.length?"hide":"show"]();$("#post-list").removeClass("loading")},this)},handleShowProfile:d(function(b){(b=this.thread.users.get($(b.currentTarget).attr("data-user")))&&this.showProfile(b)}),handleSort:d(function(b){var a=$(b.currentTarget),
b=a.closest("li"),a=a.attr("data-sort");b.siblings().removeClass("selected");b.addClass("selected");this.thread.posts.order=a;this.thread.posts.fetch();$("#conversation-menu").removeClass("open");$("#posts [data-role=more]").hide();$("#post-list").addClass("loading").empty()}),logout:d(function(){this.session.logout()}),closeThread:d(function(){this.thread.close({success:_.bind(a.sendHostMessage,a,"reset"),error:_.bind(this.alert,this,"An error occurred while closing thread. Please try again.","error")})}),
openThread:d(function(){this.thread.open({success:_.bind(a.sendHostMessage,a,"reset"),error:_.bind(this.alert,this,"An error occurred while opening thread. Please try again.","error")})}),redrawPosts:function(){var b=this;b.postViews={};b.addPosts(b.thread.posts,{clearDom:!0});_.each(v.open,function(a,c){var d=b.postViews[c];d&&(d.toggleReply(),d.reply.textarea.set(a.textarea.get()))})},addPosts:function(b,a,c){var d=this,e=[];if(b instanceof i.PostCollection)e=b.models,c=a||{};else if(b instanceof
f.Post)e=[b],c=c||{};else throw"Not a post: "+typeof b;if(e.length){var h=[];_.each(e,function(b){var a,g=b.get("parent");g&&(a=(g=d.thread.posts.get(g))&&d.postViews[g.cid]);a=new n({parent:a,model:b,thread:d.thread,session:d.session,created:c.created});d.postViews[b.cid]=a;a.render();b.get("isRealtime")&&d.removeOldPosts.call(d);g?d.postViews[g.cid].attachChild(a):h.push(a.el)});h.length&&d.updateDom(function(){var b=$("#post-list");c.clearDom&&b.empty();$("#post-list").removeClass("loading");c.created||
!e[0].id||e[0].get("isRealtime")?b.prepend(h):b.append(h);d.trigger("postsRendered")})}},showProfile:function(b){this.profile&&this.profile.remove();var c=this.profile=new H({user:b,session:this.session});this.freeze(!0);this.updateDom(function(){this.mainNav.clear();$("#profile").empty().append(c.el);this.swapMain("profile");c.show()},this);c.bind("close",function(){this.returnToConversation();this.updateDom(function(){c.remove()},this)},this);c.bind("render:all",_.once(function(){this.freeze(!1)}),
this);a.sendHostMessage("scrollTo",{top:0})},removePost:function(b){var a=this.postViews[b.cid];a&&(a.remove(),delete this.postViews[b.cid])},removeOldPosts:_.debounce(function(){if(this.switches&&this.switches.enabled("next_realtime_cap")){var b=_.size(this.postViews)-this.STREAMING_MAX_VISIBLE;if(!(b<=0))for(var a=this.thread.posts.sortBy(function(b){return moment(b.get("createdAt")).valueOf()}),c,d=0,e=0;d<a.length&&e<=b;d++)if((c=this.postViews[a[d].cid])&&c.childrenNode.children().length===0)this.thread.posts.remove(a[d]),
e+=1}},500),resize:function(){var b=$("body").height();if(!this._frozen||!(this._lastHeight&&this._lastHeight>b))this._lastHeight=b,a.sendHostMessage("resize",{height:b})},freeze:function(b){this._frozen=!!b;this._frozen===!1&&this.resize()},getPostView:function(b){return this.postViews[b]},authTwitter:function(b){b&&b.preventDefault();window.open(DISQUS.urls.oauth.twitter,"_blank","width=650,height=440")},authFacebook:function(b){b&&b.preventDefault();window.open(DISQUS.urls.oauth.facebook,"_blank",
"width=550,height=300")},authGoogle:function(b){b&&b.preventDefault();window.open(DISQUS.urls.oauth.google,"_blank","width=650,height=440")},authDisqus:function(b){b&&b.preventDefault();window.open(DISQUS.urls.login,"_blank","width=460,height=355")},authSSO:function(b){b&&b.preventDefault();if(b=j.getInstance()){var d=parseInt(b.config.sso.width||"800",10),e=parseInt(b.config.sso.height||"500",10),f=window.open(b.config.sso.url,"_blank","width="+d+",height="+e);(function aa(){c.isWindowClosed(f)?
a.sendHostMessage("reload"):_.delay(aa,500)})()}},verifyEmail:function(b){b&&b.preventDefault();b=DISQUS.serialize(DISQUS.urls.verifyEmail,{f:this.forum.id});window.open(b,"_blank","width=460,height=355")},audienceSync:function(b){b&&b.preventDefault();b=DISQUS.serialize(DISQUS.urls.authorize,{client_id:this.config.apiKey,scope:"read",response_type:"token",audiencesync:"1"});window.open(b,"_blank","width=460,height=355")}});j.getInstance=function(){return o};_.extend(j.prototype,r);_.extend(j.prototype,
q);var m=Backbone.View.extend({updateDom:function(b,a){var c=j.getInstance();c&&c.initialized?c.updateDom(b,a):_.isFunction(b)&&b.call(a)},resize:function(){var b=j.getInstance();b&&b.initialized&&b.resize()}}),x=m.extend({initialize:function(b){_.extend(this,b);this.model=b.thread},events:{"click [data-action=upvote]":"upvote","click [data-action=downvote]":"downvote","click [data-action=share:twitter]":"_onShare","click [data-action=share:facebook]":"_onShare","click [data-action=subscribe]":"subscribe",
"click [data-action=unsubscribe]":"unsubscribe","keydown #thread-subscribe-email":"subscribeKeypress","click #thread-subscribe-email":function(b){return b.stop()}},_onShare:function(b){if(b=this.extractService(b.target))o.trigger("uiAction:threadShare",b),this.share(b)},render:function(){this.setElement($(DISQUS.renderBlock("threadVotes",{thread:this.thread.toJSON(),user:this.session.toJSON(),sharing:!0})))},subscribeKeypress:function(b){if(!(b.key!=="Enter"&&b.keyCode!==13))b=b.target.value,c.validateEmail(b)?
(this.$el.find(".dropdown").removeClass("open"),this.subscribe(!0,b)):this.trigger("subscribe:error","email")},upvote:d(function(){this.vote(1)}),downvote:d(function(){this.vote(-1)}),vote:function(b){var a=this;a.trigger(b===1?"vote:up":"vote:down");var c=a.thread.get("userScore")===b;c||this.updateDom(function(){a.$el.find(".dropdown").addClass("open")});a.thread.vote(c?0:b)},subscribe:d(function(b,a){this.thread.subscribe(!0,a);this.trigger("subscribe:true")}),unsubscribe:d(function(){this.thread.subscribe(!1);
this.trigger("subscribe:false")}),_shareUrl:function(){return this.thread.url()},remove:function(){this.off();Backbone.View.prototype.remove.call(this)}});_.extend(x.prototype,r);var w=m.extend({initialize:function(b){_.extend(this,b)},render:function(){var b=DISQUS.renderBlock("userMenu",{user:this.session.toJSON(),thread:this.thread.toJSON(),logoutUrl:this.logoutUrl,showLogin:this.showLogin,feedbackUrl:this.getSurveyMonkeyUrl()});this.updateDom(function(){this.$el.html(b)},this)},getSurveyMonkeyUrl:function(){var b=
this.referrerUrl,a=this.session.user.id;return"https://www.surveymonkey.com/s/5RBPTTZ?c="+encodeURIComponent((a?[a,b]:[b]).join(";"))}}),p=new QueuedStorage(Modernizr.localstorage?window.localStorage:DISQUS.lounge.utils.hashStorage,5,"drafts.queue"),y=function(b){if(!b)throw Error("Cannot instantinate MediaStore without a valid storageKey!");this._storageKey=b;this._store=Modernizr.localstorage?window.localStorage:DISQUS.lounge.utils.hashStorage};_.extend(y.prototype,{getItems:function(){var b=this._store.getItem(this._storageKey);
return b&&h.parse(b)||{}},clear:function(){this._store.removeItem(this._storageKey)},getItem:function(b){return this.getItems()[b]},setItem:function(b,a){var c=this.getItems();c[b]=a;this._store.setItem(this._storageKey,h.stringify(c));return a},removeItem:function(b){var a=this.getItems();if(b in a)return delete a[b],this._store.setItem(this._storageKey,h.stringify(a)),!0;return!1}});var z=m.extend({events:function(){var b={"click [data-action=attach]":"_attachMedia"};window.FormData&&_.extend(b,
{dragover:"_dragOn",dragenter:"_dragOn",dragleave:"_dragOff",dragexit:"_dragOff",drop:"_drop"});return b},initialize:function(b){this.owner=b.owner;this.parent=b.parent;this.url=b.url},setElement:function(){var b=m.prototype.setElement.apply(this,arguments);this.$dragPlaceholder=this.$el.find("[data-role=drag-drop-placeholder]");this.$mediaSelector&&this.$mediaSelector.off();this.$mediaSelector=this.$el.find("input[type=file][data-role=media-upload]");this.$mediaSelector.on("change",_.bind(this._selectorChange,
this));return b},_toggleDragPlaceholder:_.throttle(function(b){b?this.$dragPlaceholder.show():this.$dragPlaceholder.hide()},50),_selectorChange:function(b){this.uploadMedia(b.target.files);if(o.switches.enabled("next_dragdrop_nag")&&b.target.files&&Modernizr.localstorage&&!window.localStorage.getItem("usedDragDrop"))this.owner.alert("Did you know you can drag and drop images too? Try it now: drag images below.").on("dismiss",function(){window.localStorage.setItem("usedDragDrop","1")})},_dragOn:function(b){b.stop();
this._toggleDragPlaceholder(!0);this.owner.owner.$el.addClass("expanded")},_dragOff:function(b){b.stop();this._toggleDragPlaceholder(!1)},_drop:function(b){b.stop();window.localStorage.setItem("usedDragDrop","1");this._toggleDragPlaceholder(!1);this.uploadMedia(b.dataTransfer.files)},_attachMedia:function(b){b.stop();this.$mediaSelector[0].click()},_uploadMediaModern:function(b){for(var a=this,d=new FormData,e=0,f=b[e];f;f=b[++e])f.type.match(/^image\//)&&d.append("attachment",f);d.append("json",
"true");this.parent&&d.append("id",this.parent.id);var i=c.makeCORSRequest("POST",this.url,function(){if(!(i.readyState!==void 0&&(i.readyState!==4||i.status!==200))){var b=h.parse(i.responseText);b.success?a.owner.addMedia(b.media):a.owner.alert(b.message,"error")}});i.withCredentials=!0;i.send(d)},_uploadMediaLegacy:function(){var b=this,a=document.createElement("iframe"),c=document.createElement("form"),d=this.$mediaSelector[0];$(d).off();var e=$(d.cloneNode(!0));d.parentNode.replaceChild(e[0],
d);e.on("change",_.bind(this._selectorChange,this));this.$mediaSelector=e;a.style.display="none";a.name="uploadFrame"+ +new Date;c.style.display="none";c.target=a.name;c.action=this.url;c.method="post";c.appendChild(a);c.appendChild(d);if(this.parent)a=document.createElement("input"),a.type="hidden",a.name="id",a.value=this.parent.id,c.appendChild(a);c.enctype="multipart/form-data";c.encoding="multipart/form-data";var f=function(a){a=h.parse(a.data);a.name==="upload"&&($(c).remove(),$(window).off("message",
f),a.data.success?b.owner.addMedia(a.data.media):b.owner.alert(a.data.message,"error"))};$(window).on("message",f);this.updateDom(function(){this.$el.append(c);c.submit()},this)},uploadMedia:function(b){this.uploadMedia=this["_uploadMedia"+(window.FormData?"Modern":"Legacy")];return this.uploadMedia(b)}}),F=m.extend({events:{"click [data-action=detach]":"_detachMedia","click ul[data-role=media-preview-list] [data-action=preview]":"_preview"},initialize:function(b){this.alert=_.bind(b.owner.alert,
b.owner);this.owner=b.owner;this.parent=b.parent;this.urls=b.urls;this.uploader=new z({owner:this,parent:this.parent,url:this.urls.add})},setElement:function(){var b=m.prototype.setElement.apply(this,arguments);this.$list=this.$el.find("ul[data-role=media-preview-list]");this.$expandedArea=this.$el.find("[data-role=media-preview-expanded]");this.expandedImg=this.$el.find("img[data-role=media-preview-expanded-image]")[0];return b},clear:function(){this.$el.addClass("empty");this.$list.empty();this._hidePreview();
this.owner.mediaStore&&this.owner.mediaStore.clear()},_$oldPreview:null,_preview:function(b){b.stop();var a=this.$expandedArea,c=this.expandedImg,d=b.currentTarget.href,e=$(b.currentTarget).closest("li");c.src!==d?this.updateDom(function(){c.src=d;a.removeClass("empty");e.addClass("active");this._$oldPreview&&this._$oldPreview.removeClass("active");this._$oldPreview=e},this):this._hidePreview()},_hidePreview:function(){this.updateDom(function(){this.$expandedArea.addClass("empty");if(this._$oldPreview)this._$oldPreview.removeClass("active"),
this._$oldPreview=null;this.expandedImg.src=null},this)},_detachMedia:function(b){b.stop();this.updateDom(function(){this.removeMedia($(b.target).closest("li"))},this)},addMedia:function(b){var a=$(DISQUS.renderBlock("mediaUpload",{media:b}));this.owner.mediaStore.setItem(b.location,b);a.attr("data-media-id",b.location);this.updateDom(function(){this.$list.append(a);this.$el.removeClass("empty")},this)},removeMedia:function(b){var a=this.owner.mediaStore.getItem(b.attr("data-media-id")),c=this._$oldPreview;
if(a){c&&b[0]===c[0]&&this._hidePreview();c={media:h.stringify(a)};if(this.parent)c.id=this.parent.id;(new Image).src=DISQUS.serialize(this.urls.remove,c,!0);this.owner.mediaStore.removeItem(a.location);this.updateDom(function(){b.remove();this.$list.children().length||this.$el.addClass("empty")},this)}}}),v=m.extend({events:{"click [data-nav]":"showAuthSection","click [name=author-register]":"expandRegister"},initialize:function(b){this.session=b.session;this.parent=b.parent;this.thread=b.thread;
this.parentView=b.parentView;this.thread.bind("change:id",function(){this.restoreDraft();if(this.thread.forum.get("settings").allowMedia)this.mediaStore=new y(this.storageKey("media"))},this);this.session.on("change:id",this.redraw,this);this.parent&&(v.open[this.parent.cid]=this);this.textarea=Modernizr.contenteditable&&!DISQUS.browser.mobile&&(!window.opera||!window.opera.version)?new A({thread:this.thread}):new D;if(this.thread.forum.get("settings").allowMedia){if(b=this.storageKey("media"))this.mediaStore=
new y(b);this.mediaUploads=new F({owner:this,parent:this.parent,urls:{add:this.thread.get("uploadAdd"),remove:this.thread.get("uploadRemove")}})}},storageKey:function(b){if(!this.thread.id)return null;return[b||"drafts","thread",this.thread.id,"parent",this.parent?this.parent.id:0].join(":")},saveDraft:function(){this.storageKey()!==null&&p.setItem(this.storageKey(),h.stringify([this.textarea.get(),(new Date).getTime()]))},getDraft:function(){if(this.storageKey()===null)return null;var b=p.getItem(this.storageKey());
if(!b)return null;b=h.parse(b);if(b[1]+86400>(new Date).getTime())return b[0];p.removeItem(this.storageKey());return null},restoreDraft:function(){this.textarea.set(this.getDraft())},updateAvatar:function(){this.$el.find("[data-role=user-avatar]").attr("src",this.session.user.get("avatar").cache)},expandGuestForm:function(){this.$el.find("[data-role=guest-details]").addClass("expanded")},expandRegister:function(){this.$el.toggleClass("register")},redraw:function(){var b=this.$el.hasClass("expanded"),
a=this.el,c=this.$el.find("textarea").val();this.render();this.$el.find("textarea").val(c);b&&this.$el.addClass("expanded");$(a).parent().length!==0&&this.updateDom(function(){a.parentNode.replaceChild(this.el,a)},this)},render:function(){var b=this,a=b.getDraft()||"";this.setElement($(DISQUS.renderBlock("form",{message:a,parent:b.parent?b.parent.toJSON():null,user:b.session.toJSON(),mediaList:this.mediaStore?_.values(this.mediaStore.getItems()):[],allowAnonPost:b.thread.forum.get("settings").allowAnonPost,
allowMedia:b.thread.forum.get("settings").allowMedia})));this.$el.find("form").bind("submit",_.bind(this.submitForm,this));a=this.textarea;a.setElement(b.$el.find("textarea")[0]);a.render();a.bind("keychange",_.debounce(this.saveDraft,500),this);a.$el.bind("focus",function(){b.$el.addClass("expanded focus");_.delay(_.bind(b.resize,b),200)});a.$el.bind("blur",function(){b.$el.removeClass("focus")});this.mediaUploads&&(this.mediaUploads.setElement(this.$el.find("[data-role=media-preview]")[0]),this.mediaUploads.uploader.setElement(this.$el.find("[data-role=textarea]")[0]));
b.$el.find("input[name=author-name]").bind("focus",function(){b.expandGuestForm()});b.typingStart();b.session.mustVerifyEmail&&b._alertMustVerify()},resize:function(){this.textarea.resize()},showAuthSection:function(b){b&&b.preventDefault&&b.preventDefault();var a=b.currentTarget.getAttribute("data-nav");this.updateDom(function(){var b=this.$el.find("[data-nav]");_.each(b,function(b){$(b.parentNode).removeClass("active")});this.$el.find("[data-nav="+a+"]").parents("*").addClass("active");this.$el.find("section").hide();
this.$el.find("[data-tab="+a+"]").show()},this)},focus:function(){this.textarea.focus()},clear:function(){var b=this;b.textarea.clear();b.$el.removeClass("expanded");b.mediaUploads&&b.mediaUploads.clear();_.delay(function(){b.resize()},200);b.parent?b.$el.hide():b.$el.removeClass("expanded");this.storageKey()&&p.removeItem(this.storageKey())},restore:function(b){var a=this;a.textarea.set(b.get("raw_message"));_.delay(function(){a.resize()},200);a.parent&&a.$el.show()},_alertMustVerify:function(b){this.alert([this.thread.forum.get("name"),
'requires you to <a href="#" data-action="verify-email">verify your email address</a> before posting'].join(" "),{safe:!0,type:b?"error":"warn"})},submitForm:function(b){var a=this;b&&b.preventDefault&&b.preventDefault();if(this._alert)this._alert.remove(),this._alert=null;b=a.$el.find("input[name=author-register]");b=b.length&&b[0].checked;if(a.session.isAnonymous()&&b)return a.session.register({name:a.$el.find("input[name=author-name]").val(),email:a.$el.find("input[name=author-email]").val()},
{error:function(){a.alert("That email address is already registered with a Disqus account. Log in or enter another email.","alert")}}),null;return a.createPost()},createPost:function(){var b=this,a={thread:b.thread.id,depth:b.parent?b.parent.get("depth")+1:0,parent:b.parent?b.parent.id:null,raw_message:b.textarea.get()};b.session.isRegistered()?a.author_id=b.session.user.id:_.extend(a,{author_name:b.$el.find("input[name=author-name]").val(),author_email:b.$el.find("input[name=author-email]").val()});
var c=new DISQUS.lounge.models.UniqueModel(DISQUS.lounge.models.Post);if(c.set(a,{error:function(a,c){b.alert(c,"error")}})){var d=null,e=function(a,e){if(e.code===19){if(d)return d.reload();d=new K;d.render();var g=o.getPostView(c.cid);g.el.parentNode.insertBefore(d.el,g.el);d.start();d.bind("submitted",function(){c.save({recaptcha_challenge_field:d.getChallenge(),recaptcha_response_field:d.getResponse()},{success:function(){d.remove()}})})}else e.code===12&&/verify/.test(e.response)?b._alertMustVerify(!0):
_.isString(e.response)&&b.alert(e.response,"error"),b.thread.posts.remove(c),b.restore(c),b.thread.incrementPostCount(-1)};c.on("error",e);c.on("sync",function Z(){b.thread.trigger("create",c);c.off("error",e);c.off("sync",Z)});c.save(a);c.author=b.session.isRegistered()?b.session.user:new f.UniqueModel(f.User,{id:md5(a.author_email),name:a.author_name,email:a.author_email});b.thread.posts.add(c,{created:!0});b.clear();b.trigger("submitted");b.thread.incrementPostCount(1);o.trigger("uiAction:createPost",
c);return c}},remove:function(){this.updateDom(function(){this.$el.remove()},this);this.parent&&(delete v.open[this.parent.cid],this.typingStop())},toggle:function(){this.$el.toggle();this.isOpen()?this.typingStart():this.typingStop()},isOpen:function(){return this.el.style.display!=="none"},typingStart:function(){var b=this;if(b.parent){var a=j.getInstance();a.switches&&a.switches.enabled("next_realtime")&&_.delay(function(){var a=DISQUS.urls.realertime+"/api/2/typing/",d;c.attempt(function(){d=
c.makeCORSRequest("POST",a)});if(d===null)return void DISQUS.log("CORS is not supported by this browser.");var e=h.stringify({typing:!0,forum_url:b.thread.get("forum"),thread_id:b.thread.get("id"),user_id:b.session.user.id||0,parent_post_id:b.parent.get("id")});c.attempt(function(){d.send(e)})},500)}},typingStop:function(){var b=this;if(b.parent){var a=j.getInstance();a.switches&&a.switches.enabled("next_realtime")&&_.delay(function(){var a=DISQUS.urls.realertime+"/api/2/typing/",d;c.attempt(function(){d=
c.makeCORSRequest("POST",a)});if(d===null)return void DISQUS.log("CORS is not supported by this browser.");var e=h.stringify({typing:!1,forum_url:b.thread.get("forum"),thread_id:b.thread.get("id"),user_id:b.session.user.id||0,parent_post_id:b.parent.get("id")});c.attempt(function(){d.send(e)})},500)}}});_.extend(v.prototype,q);v.open=v.open||{};var t=m.extend({initialize:function(b){this.post=b.post;this.textarea=new D},render:function(){this.setElement($(DISQUS.renderBlock("edit",{post:this.post.toJSON()})));
this.$el.find("form").bind("submit",_.bind(this.submitForm,this));var b=this.textarea;b.setElement(this.$el.find("textarea")[0]);b.render()},resize:function(){this.textarea.resize()},submitForm:function(b){b&&b.preventDefault()&&b.preventDefault();var b={raw_message:this.textarea.get()},a=this.post.validate(b);if(a!==void 0)return alert(a);this.trigger("submitted");this.post.save(b,{success:function(){}})},remove:function(){this.updateDom(function(){this.$el.remove()},this)}}),n=m.extend({MAX_INDENT_DEPTH:3,
initialize:function(b){this.thread=b.thread;this.session=b.session;this.created=!!b.created;this.model.bind("destroy",this.removeAsDeleted,this);this.model.bind("spam",this.removeAsDeleted,this);this.model.bind("change:message",this.stopLoading,this);this.model.bind("change:points",this.updatePoints,this);this.model.bind("change:userScore",this.updateVotes,this);this.model.usersTyping.bind("add remove reset",this.updateTypingCount,this);this.session.on("change:id",this.updateEditHide,this);this.session.on("change:id",
this.updateFooter,this);this.session.on("change:id",this.updateMenu,this);this.model.bind("change",function(){var b=this.model.changedAttributes();(b.id||b.message)&&this.redraw()},this);this.edit=this.reply=null;this.parent=b.parent;this.trackPosition=!1;j.getInstance().on("domReflow",function(){if(this.trackPosition){var b=this.contentNode;this.offset=b.offset();this.dim=b.dim()}else this.offset={top:-1,height:-1},this.dim={height:-1,width:-1}},this)},updateTypingCount:function(){this.typingUserView&&
this.typingUserView.render()},stopLoading:function(){this.contentNode.find(".loading").removeClass("loading")},updateRelativeTime:function(){this.contentNode.find("[data-role=relative-time]").text(this.model.getRelativeCreatedAt())},updateVotes:function(b){var a=this.contentNode.find("[data-role=voting]"),c=DISQUS.renderBlock("postVotes",{post:{userScore:b.get("userScore"),points:b.get("points"),likes:b.get("likes"),dislikes:b.get("dislikes")}});this.updateDom(function(){a.html(c)})},updateEditHide:function(){var b=
this.contentNode.find("[data-role=edit-hide]"),a=DISQUS.renderBlock("postEditHide",{post:{author:{id:this.model.author.id}},session:{id:this.session.user.id}});this.updateDom(function(){b.html(a)})},updateFooter:function(){var b=this.contentNode.find("footer"),a=DISQUS.renderBlock("postFooter",{post:this.model.toJSON(),session:this.session.toJSON(),thread:this.thread.toJSON()});this.updateDom(function(){b.html(a)})},updateMenu:function(){var b=this.contentNode.find("[data-role=menu]"),a=DISQUS.renderBlock("postMenu",
{session:this.session.toJSON(),post:this.model.toJSON()});this.updateDom(function(){b.html(a)})},updatePoints:function(b){var a=function(b){_.delay(function(){b.addClass("update");_.delay(function(){b.removeClass("update")},1E3)},500)};this.contentNode.find("[data-role=points], [data-role=likes], [data-role=dislikes]").each(function(c){var c=$(c),d=c.html(),e=b.get(c.attr("data-role")).toString();d!==e&&(c.removeClass("count-"+e),c.removeClass("count-"+d),c.html(e),a(c))})},markSeen:function(){function b(d){var e,
f;if(!d)return!1;e=a.offset.top+d.frameOffset.top;f=(f=e>d.pageOffset)&&e+a.dim.height<=d.pageOffset+d.height;if(!f)return!1;a.contentNode.addClass("seen");_.delay(function(){a.contentNode.removeClass("seen");a.contentNode.removeClass("new")},1E4);a.trackPosition=!1;c.off("scroll",b);return!0}var a=this,c=j.getInstance();if(!b(c.position))c.on("scroll",b,a);c.off("domReflow",a.markSeen)},mentionParent:function(){if(this.model.id&&this.model.get("message")&&!(this.model.get("depth")<=this.MAX_INDENT_DEPTH)&&
this.contentNode){var b=this.contentNode.find("[data-role=message]"),a=b.children().first();a.length||(a=b);if(b=this.thread.posts.get(this.model.get("parent"))){var c=b.author.get("name")||b.author.get("username"),d=this.model.messageText().indexOf(c);d>-1&&d<25||$(DISQUS.renderBlock("mention",{url:b.author.get("profileUrl"),name:c})).prependTo(a)}}},render:function(){var b=this;b.setElement($(DISQUS.renderBlock("post",{post:b.model.toJSON(),session:b.session.toJSON(),thread:b.thread.toJSON(),loading:!b.model.id,
created:b.created})));b.contentNode=b.$el.find("[data-role=post-content]");b.childrenNode=b.$el.find("[data-role=children]");this.highlightSyntax();b.model.get("depth")>b.MAX_INDENT_DEPTH&&b.mentionParent();if(b.model.get("isRealtime"))j.getInstance().switches.enabled("next_realtime_anim_disabled")?b.contentNode.removeClass("new"):(b.trackPosition=!0,o.on("domReflow",b.markSeen,b));o.on("domReflow",_.once(function(){var a=b.$el.find("[data-role=realtime-notification:"+b.model.id+"] .realtime-replies");
b.typingUserView=new M({parentView:b,model:b.model,el:a})}));b.processMentions();b.bindDomEvents();var a=b.parent&&b.parent.model;if(a&&!a.get("isDeleted"))b.contextCard=I.create({post:this.parent.model,targetElement:this.$el.find("[data-role=parent-link]")})},highlightSyntax:function(){var b=this.contentNode.find("pre code");b.length&&b.each(function(b){c.syntaxHighlighter.highlight(b)})},redraw:function(){var b=this.$el;if(!b)throw Error("Old child not found on PostView.redraw");var a=this.childrenNode.children();
this.render();this.updateDom(function(){b[0].parentNode.replaceChild(this.el,b[0]);this.childrenNode.append(a)},this)},processMentions:function(){this.contentNode.find("[data-dsq-mention]").each(function(){$(this).addClass("mention")})},attachChild:function(b){var a=b.model;!a.id||a.get("isImmediateReply")?this.childrenNode.prepend(b.el):this.childrenNode.append(b.el)},toggleReply:function(){if(this.reply)return void this.reply.toggle();this.reply=new v({parentView:this,parent:this.model,thread:this.thread,
session:this.options.session});this.reply.bind("submitted",function(){this.reply.$el.hide()},this);this.drawReply()},drawReply:function(){this.reply&&(this.reply.render(),this.updateDom(function(){var b=this.childrenNode[0];b.insertBefore(this.reply.el,b.firstChild);this.reply.focus()},this))},toggleEdit:function(){this.edit?(this.edit.remove(),this.edit=null,this.contentNode.find("[data-role=message]").show()):(this.edit=new t({post:this.model}),this.edit.render(),this.edit.bind("submitted",this.toggleEdit,
this),this.updateDom(function(){var b=this.contentNode.find("[data-role=message]");b[0].parentNode.insertBefore(this.edit.el,b[0]);b.hide();this.edit.resize();(b=j.getInstance())&&b.scrollToPost(this.model.id)},this))},removeAsDeleted:function(){this.redraw()},bindDomEvents:function(){var b=this;b.delegateActions(b.contentNode,{upvote:function(){b.handleVote(1)},downvote:function(){b.handleVote(-1)},reply:"handleReply",flag:"handleFlag",edit:"handleEdit","delete":"handleDelete",spam:"handleSpam",
blacklist:"handleBlacklist",collapse:"handleCollapse",reveal:"handleReveal","share:twitter":"_onShare","share:facebook":"_onShare"});var a=b.$el.find(".hovercard");if(a.length)b.profileCard=E.create({session:b.session,user:b.model.author,targetElement:a})},_onShare:function(b){if(b=this.extractService(b.target))o.trigger("uiAction:postShare",b),this.share(b)},_shareUrl:function(){return this.thread.url()+"#comment-"+this.model.id},handleBlacklist:function(){if(!this.blacklist){var b=this.blacklist=
new T({model:this.model});b.render();b.on("success cancel",function(){this.blacklist.remove();this.blacklist=null},this);this.updateDom(function(){this.contentNode.find("[data-role=blacklist-form]").first().append(b.el)},this)}},handleCollapse:function(){this.updateDom(function(){this.$el.toggleClass("collapsed")},this)},handleVote:function(b){b===1?o.trigger("uiAction:postUpvote"):b===-1&&o.trigger("uiAction:postDownvote");var a=this.model.get("userScore")===b;this.model.vote(a?0:b);var c=this.contentNode.find("[data-role=voting]");
c.removeClass("upvoted").removeClass("downvoted");a||(b>0?c.addClass("upvoted"):b<0&&c.addClass("downvoted"))},remove:function(){this.model.off(null,null,this);this.session.off(null,null,this);Backbone.View.prototype.remove.call(this)},handleReply:function(){this.toggleReply()},handleFlag:function(){window.confirm("Are you sure you want to flag this comment?")&&this.model.report()},handleEdit:function(){this.toggleEdit()},handleDelete:function(){this.model.destroy()},handleSpam:function(){this.model.spam()},
handleReveal:function(){this.model.set("isMinimized",!1);this.redraw()}});_.extend(n.prototype,r);var K=m.extend({render:function(){var b=this;b.setElement($(DISQUS.renderBlock("captcha")));b.$el.bind("submit",function(a){a.preventDefault();b.trigger("submitted")})},start:function(){function b(){a.updateDom(function(){Recaptcha.create("6LdKMrwSAAAAAPPLVhQE9LPRW4LUSZb810_iaa8u",a.el,{theme:"custom",custom_theme_widget:"recaptcha_widget"});a.$el.show()})}var a=this;typeof Recaptcha==="undefined"?DISQUS.require("//www.google.com/recaptcha/api/js/recaptcha_ajax.js",
{},!1,b):b()},getChallenge:function(){return Recaptcha.get_challenge()},getResponse:function(){return Recaptcha.get_response()},reload:function(){Recaptcha.reload()}}),L=m.extend({initialize:function(){this.collection.bind("add reset remove",this.render,this);this.render()},render:function(){this.$el.text(this.collection.length);this.collection.length>0?this.$el.show():this.$el.hide();return this}}),C=Backbone.View.extend({__type__:"QueuedPostView",getDirection:function(b){var a=b.pageOffset,c=this.offset.top+
b.frameOffset.top;if(c+this.dim.height<a)return 1;if(c>a+b.height)return-1;return 0},setCount:function(b){this.options.count=b},bindDrain:function(b){if(!this.clickEvent)this.$el.attr("data-action")=="load-queued-posts"?this.$el.bind("click",b):this.$el.delegate("[data-action=load-queued-posts]","click",b),this.clickEvent=!0},render:function(){var b=this;if(b.options.count===0)return void b.$el.hide();b.$el.html(DISQUS.renderBlock("realtimeCommentNotification",{comments:b.options.count}));b.bindDrain(function(){b.model.queue.drain();
b.setCount(b.model.queue.length);b.render()});j.getInstance().on("domReflow",_.throttle(function(){if(b.options.count!==0)this.offset=b.$el.offset(),this.dim=b.$el.dim()},400),this);b.$el.show()}}),N=C.extend({getDirection:function(b){this.offset=this.options.postView.offset;this.dim=this.options.postView.dim;b=C.prototype.getDirection.call(this,b);delete this.offset;delete this.dim;return b},render:function(){var b=this,a=b.options.postView;DISQUS.log("Model:",b.model.id);b.options.count===0?(b.$el.hide(),
a.trackPosition=!1):(a.trackPosition=!0,b.$el.html(DISQUS.renderBlock("realtimeReplyNotification",{replies:b.options.count})),b.bindDrain(function(){b.options.thread.queue.drain(b.model.id);b.setCount(b.options.thread.queue.length);a.trackPosition=!1;b.render()}),b.$el.show(),_.delay(function(){b.$el.addClass("reveal")},13))}}),M=Backbone.View.extend({render:function(){var b=this.model.usersTyping.count(),a=this.options.parentView.reply;a&&a.isOpen()&&(b-=1);if(b<=0)return void this.$el.hide();b==
1?this.$el.html("One other user is typing&hellip;"):this.$el.html(b+" other users are typing&hellip;");this.$el.show()}}),U=m.extend({tagName:"ul",initialize:function(){this.collection.bind("reset",this.render,this)},render:function(){this.updateDom(function(){var b=this;b.$el.empty();b.collection.length?b.collection.each(function(a){a=DISQUS.renderBlock("notification",{rawHtmlContent:a.get("formatted").text,timeAgo:moment(a.get("timestamp")).fromNow()});b.$el.append($(a))}):b.$el.text("You have no new notifications.");
this.trigger("render")},this);return this}}),J=m.extend({tagName:"ul",className:"loading",initialize:function(b){this.collection.bind("reset",this.render,this);this.session=b.session},render:function(){this.updateDom(function(){this.$el.removeClass("loading");this.$el.empty();this.collection.each(function(b){this.$el.append(DISQUS.renderBlock("activityItem",{activity:b.toJSON(),session:this.session?this.session.toJSON():null}))},this);this.trigger("render")},this);return this}}),Q=Backbone.View.extend({initialize:function(b){var a=
this;a.notifications=new U({collection:b.notifications});a.activity=new J({collection:new i.PostActivityCollection,session:o.session});Backbone.when([a.notifications,"render"],[a.activity,"render"]).then(function(){a.isRendered=!0;a.trigger("render:all")});a.render();a.fetched=!1},render:function(){this.$el.html(DISQUS.renderBlock("dashboard"));this.$el.find("[data-role=notifications]").append(this.notifications.el).show();this.$el.find("[data-role=activity]").append(this.activity.el).show()},show:function(){if(!this.fetched)this.activity.collection.fetch(),
this.fetched=!0,this.notifications.collection.markRead()}}),V=m.extend({tagName:"ol",className:"loading",initialize:function(){this.collection.bind("reset",function(){this.updateDom(this.render,this)},this)},render:function(){this.updateDom(function(){this.$el.removeClass("loading");this.$el.empty();this.collection.each(function(b){var a=DISQUS.assureOffset(b.get("createdAt"));this.$el.append(DISQUS.renderBlock("topThread",{id:b.id,title:b.get("title"),url:b.get("link"),numPosts:b.get("postsInInterval"),
numLikes:b.get("likes"),timeAgo:moment(a,DISQUS.ISO_8601).fromNow()}))},this);this.trigger("render")},this);this.attachPosts();return this},attachPosts:function(){this.collection.each(function(b){this.renderPost(b)},this)},renderPost:function(b){var a=b.get("topPost");if(a){var c=_.strip(a.message),c=_.truncate(c,160,"&hellip;"),d=DISQUS.renderBlock("topThreadPost",{message:c,author:a.author});this.updateDom(function(){this.$el.find("[data-role=thread-"+b.id+"] [data-role=top-thread-post]").html(d)},
this)}}}),W=m.extend({tagName:"ol",className:"loading",initialize:function(){this.collection.bind("reset",function(){o.thread.users.add(this.collection.models,{merge:!0});this.updateDom(this.render,this)},this)},render:function(){this.updateDom(function(){this.$el.removeClass("loading");this.$el.empty();this.collection.each(function(b){this.$el.append(DISQUS.renderBlock("topUser",{user:b.toJSON()}))},this);this.trigger("render")},this);return this}}),R=Backbone.View.extend({initialize:function(b){var a=
this;a.forum=b.forum;a.topThreads=new V({id:"top-threads",collection:new i.TopThreadCollection(null,{forum:a.forum.id,limit:10})});a.topUsers=new W({id:"top-users",collection:new i.TopUserCollection(null,{forum:a.forum.id,limit:20,discardLowRep:o.switches.enabled("next_discard_low_rep")})});Backbone.when([a.topUsers,"render"],[a.topThreads,"render"]).then(function(){a.isRendered=!0;a.trigger("render:all")});a.fetched=!1;a.render()},render:function(){this.$el.html(DISQUS.renderBlock("community",{forum:this.forum.toJSON()}));
this.$el.find("[data-role=top-threads]").append(this.topThreads.el);this.$el.find("[data-role=top-users]").append(this.topUsers.el);return this},show:function(){if(!this.fetched)this.topThreads.collection.fetch(),this.topUsers.collection.fetch(),this.fetched=!0}}),da=m.extend({initialize:function(b){this.$el.addClass("loading");this.thread=b.thread;this.session=b.session;this.collection.on("add reset",this.render,this)},render:function(b,a,c){var d=this,e=(c&&c.index!=null?[d.collection.at(c.index)]:
d.collection).map(function(b){b=new X({model:b,thread:d.thread,session:d.session});b.render();return b.el});d.updateDom(function(){d.$el.removeClass("loading");d.$el.append(e);d.isRendered=!0;d.trigger("render:all")})},show:function(){this.collection.length>0||this.collection.fetch()}}),r={toggleFollow:function(b){b.preventDefault();this.user.get("isFollowing")?(this.user.unfollow(),$(b.target).removeClass("active")):($(b.target).addClass("active"),this.user.follow(),o.trigger("uiAction:followUser"))}},
H=Backbone.View.extend({events:{"click [data-action=close]":"close","click [data-action=toggleFollow]":"toggleFollow"},initialize:function(b){var a=this;a.user=b.user;a.session=b.session;a.user.get("numFollowers")===null&&a.user.fetch({success:function(){a.updateStats()}});a.user.on("change",a.updateStats,a);a.user.on("change:connections",a.updateConnections,a);a.user.on("change:isFollowing",a.updateActions,a);a.activity=new J({id:"activity",collection:new i.ActivityCollection(null,{user:a.user,include:"user"}),
session:a.session});a.activity.on("render",function(){a.isRendered=!0;a.trigger("render:all")});a.render()},updateStats:function(){this.$el.find("[data-role=profile-stats]").html(DISQUS.renderBlock("profileStats",{user:this.user.toJSON()}))},updateActions:function(){this.$el.find("[data-role=actions]").html(DISQUS.renderBlock("profileActions",{user:this.user.toJSON(),sessionId:this.session.user.id}))},updateConnections:function(){DISQUS.blocks.profileConnections&&this.$el.find("[data-role=connections]").html(DISQUS.renderBlock("profileConnections",
{user:this.user.toJSON()}))},close:function(){this.trigger("close")},render:function(){this.$el.empty();this.$el.append(DISQUS.renderBlock("profile",{user:this.user.toJSON(),sessionId:this.session.user.id}));this.$el.find("[data-role=activity]").append(this.activity.el)},show:function(){this.activity.collection.fetch()}});_.extend(H.prototype,r);var s=m.extend({initialize:function(){this._id=_.uniqueId();this._hoverState="out";this._leaveTimeout=this._enterTimeout=null;s.open={}},bindEvents:function(){var b=
this;b.$el.bind("mouseover",function(){b.enter()});b.$el.bind("mouseout",function(){b.leave()})},target:function(b){var a=this;b.bind("mouseover",function(){a.enter(b)});b.bind("mouseout",function(){a.leave()})},enter:function(b){var a=this;if(b)this.$target=b;a._leaveTimeout&&clearTimeout(a._leaveTimeout);if(a._hoverState!=="in")a._hoverState="in",a._enterTimeout=_.delay(function(){a._hoverState==="in"&&a.show();a._enterTimeout=null},s.DELAY_ENTER),s.open[this.uid]=this},leave:function(){var b=this;
b._enterTimeout&&clearTimeout(b._enterTimeout);if(b._hoverState!=="out")b._hoverState="out",b._leaveTimeout=_.delay(function(){b._hoverState==="out"&&b.hide();b._leaveTimeout=null},s.DELAY_LEAVE),s.open[this.uid]&&delete s.open[this.uid]},show:function(){this.$target.append(this.el)},hide:function(){this.$el.remove()}},{open:{},instances:{},DELAY_ENTER:350,DELAY_LEAVE:175,exitAll:function(){_.invoke(s.open,"leave")},create:function(b,a,c,d){var e=s.instances[c];e||(s.instances[c]=e={});c=e[b];c||
(c=new d(a),e[b]=c,c.render());c.target(a.targetElement);return c}});(function(){$(document).bind("mouseout",_.debounce(function(b){b=b.relatedTarget||b.toElement;(!b||b.nodeName==="HTML")&&s.exitAll()}),10)})();var E=s.extend({events:{"click [data-action=toggleFollow]":"toggleFollow"},initialize:function(b){var a=this;s.prototype.initialize.call(a,b);a.session=b.session;a.user=b.user;a.user.on("change:numPosts change:numLikesReceived",_.debounce(function(){a.updateCounters()}));a.user.on("change:isFollowing",
function(){a.updateActions()});a.session.on("change:id",function(){a.render()})},render:function(){var b=this.user.toJSON();if(b.about)b.about=_.truncate(b.about,80,"...");this.setElement($(DISQUS.renderBlock("hovercard",{user:b,sessionId:this.session.user.id})));this.bindEvents()},updateCounters:function(){var b=this.$el.find("[data-role=counters]");this.updateDom(function(){b.html(DISQUS.renderBlock("hovercardCounters",{user:this.user.toJSON(),sessionId:this.session.user.id}))},this)},updateActions:function(){var b=
this.$el.find("[data-role=actions]");this.updateDom(function(){b.html(DISQUS.renderBlock("hovercardActions",{user:this.user.toJSON(),sessionId:this.session.user.id}))},this)},show:function(){this.user.get("numLikesReceived")===null&&this.user.fetch();s.prototype.show.call(this)}},{create:function(b){return s.create(b.user.id,b,"ProfileCard",E)}});_.extend(E.prototype,r);var I=s.extend({initialize:function(b){s.prototype.initialize.call(this,b);this.post=b.post},render:function(){var b=this.post.toJSON();
b.excerpt=_.truncate(_.strip(b.message),40,"...");this.setElement($(DISQUS.renderBlock("contextCard",{post:b})));this.bindEvents()}},{create:function(b){if(DISQUS.blocks.contextCard)return s.create(b.post.id,b,"ContextCard",I)}}),X=m.extend({events:{"click [data-action=remove]":"destroyReaction"},initialize:function(b){this.thread=b.thread;this.session=b.session;this.session.on("change:id",this.renderMenu,this)},render:function(){this.setElement($(DISQUS.renderBlock("reaction",{reaction:this.model.toJSON(),
thread:this.thread.toJSON()})))},renderMenu:function(){var b=this.$el.find("[data-role=menu]"),a=DISQUS.renderBlock("reactionMenu",{thread:this.session.toJSON().thread});this.updateDom(function(){b.html(a)},this)},destroyReaction:function(b){b&&b.preventDefault&&b.preventDefault();this.model.destroy();this.updateDom(function(){this.remove()},this)}}),O=m.extend({events:{"click [data-action=dismiss]":"dismiss"},initialize:function(b){_.extend(this,b)},render:function(){this.setElement($(DISQUS.renderBlock("alert",
{message:this.message,type:this.type,safe:this.safe})));return this},dismiss:function(b){b&&b.preventDefault&&b.preventDefault();this.remove();this.trigger("dismiss")}}),T=m.extend({events:{"click [data-action=cancel]":"cancel"},initialize:function(){var b=this;b.loading=!1;if(!b.model.get("ipAddress"))b.loading=!0,b.model.on("change:ipAddress",function u(){b.model.off("change:ipAddress",u);b.loading=!1;b.redraw()}),b.model.fetch()},render:function(){var b=this;b.setElement($(DISQUS.renderBlock("blacklist",
{loading:this.loading,post:b.model.toJSON()})));b.$el.bind("submit",function(a){a&&a.preventDefault()&&a.preventDefault();b.submit()});return b},redraw:function(){var a=this.el.parentNode;a&&(this.render(),this.updateDom(function(){$(a).empty().append(this.el)},this))},cancel:function(a){a&&a.preventDefault()&&a.preventDefault();this.trigger("cancel")},submit:function(){var a={},c=this;c.$el.find("input").each(function(){if(this.checked)a[this.name]=this.value});if(!_.isEmpty(a))a.forum=c.model.get("forum"),
DISQUS.api.call("blacklists/add.json",{method:"POST",data:a,success:function(){c.trigger("success")}})}}),D=m.extend({events:{keyup:"handleKeychange",paste:"handleKeychange"},render:function(){var a=this;a.$el.autoresize({maxHeight:350});a.$el.bind("resize",_.throttle(function(){_.delay(_.bind(a.updateDom,a),200)},500));return a},resize:function(){this.$el.trigger("paste")},get:function(){return this.$el.val()},set:function(a){this.$el.val(a)},clear:function(){this.set("")},focus:function(){this.el.focus()},
handleKeychange:function(){this.trigger("keychange")}}),A=D.extend({initialize:function(a){a=a||{};this.thread=a.thread;this.mentionsCache=new i.UserCollection;this.suggestions=new Y({thread:a.thread,mentions:this.mentionsCache});this.placeholder="";this.suggestions.on("select",this.insertMention,this);this.reset()},reset:function(){this.searchTerms=this.anchorOffset=this.anchorNode=null;this.suggestions.clear()},render:function(){var a=this.el.placeholder,c=document.createElement("div");_.extend(c,
{className:"textarea",contentEditable:!0,innerHTML:this.el.value,tabIndex:this.el.tabIndex});c.setAttribute("role","textbox");c.setAttribute("aria-multiline","true");var d=this.el.parentNode;d.replaceChild(c,this.el);this.setElement(c);this.bindKeyEvents();d.appendChild(this.suggestions.el);this.content=new Editable(this.el);D.prototype.render.call(this);if(a)this.placeholder='<span class="placeholder">'+a+"</span>",this.$el.html()||this.$el.html(this.placeholder),this.$el.bind("focus",_.bind(function(){this.isPlaceholder()&&
this.$el.empty()},this)),this.$el.bind("blur",_.bind(function(){this.content.text()===""&&this.$el.html(this.placeholder)},this));return this},isPlaceholder:function(){return this.$el.find(".placeholder").length!==0},bindKeyEvents:function(){this.$el.bind("keydown",_.bind(function(a){switch(a.keyCode){case 9:this.suggestions.active&&(this.suggestions.select(),a.preventDefault(),a.stopPropagation());break;case 10:case 13:case 38:case 40:this.suggestions.active&&(a.preventDefault(),a.stopPropagation())}},
this));var a=_.throttle(_.bind(this.suggest,this),500);this.$el.bind("keyup",_.bind(function(c){c.preventDefault();c.stopPropagation();this.checkExistingMentions();switch(c.keyCode){case 50:if(!c.shiftKey)break;this.start(c);break;case 10:case 13:this.suggestions.select();break;case 27:this.reset(c);break;case 38:this.suggestions.move("up");break;case 40:this.suggestions.move("down");break;default:a(c)}},this))},start:function(){this.reset();this.suggest()},suggest:function(){this.suggestions.suggest(this.parseSearchTerms())},
insertMention:function(a){var c=this.thread.users.getByCid(a);this.selectSearchString(c);this.mentionsCache.getByCid(a)||this.mentionsCache.add(c);this.content.insertHTML(A.getMentionHtml(c));a=this.$el.find("span[data-cid]");_.each(a,function(a){if(a.contentEditable!==!1)a.contentEditable=!1})},selectSearchString:function(){this.content.selectNodeText(this.anchorNode,this.anchorOffset-1,this.anchorOffset+Editable.normalizeSpace(this.anchorNode.nodeValue.slice(this.anchorOffset)).toLowerCase().length)},
get:function(){var a=this,c=A.isMention;if(this.isPlaceholder())return"";return this.content.text(function(d){return c(d,!0)?a.mentionToText(d):null})},set:function(a){this.el.innerHTML=a},parseSearchTerms:function(){var a=this.content.selectedTextNode(),c=a?a.nodeValue:"",d=Editable.normalizeSpace;if(c){var e=this.content.selectedTextNodeOffset(a),f=Editable.normalizeSpace(c.slice(0,e).split("").reverse().join("")).indexOf("@");if(f===-1)return null;this.anchorNode=a;this.anchorOffset=e-f;if(a=d(c.slice(this.anchorOffset-
1,e)).match(A.MENTIONS_RE))return a[0].slice(1).split(" ");if(f===0)return[""]}},checkExistingMentions:function(){var a=Editable.normalizeSpace,c=this.$el.find("span"),c=_.filter(c,A.isMention),d=this.mentionsCache,e={};_.each(c,function(c){var f=$(c).attr("data-cid"),g=_.reduce(this.content.getTextNodes(c),function(c,d){return c+a(d.nodeValue)},""),h=d.getByCid(f);h.get("name")!==g?(this.mentionsCache.remove(h),this.content.removeNode(c),this.content.insertHTML(" "),this.reset()):e[f]=c},this);d.each(function(a){e[a.cid]||
d.remove(a)})},mentionToText:function(a){a=this.mentionsCache.getByCid($(a).attr("data-cid"));return["@",a.get("username")||a.get("emailHash"),":disqus"].join("")}},{MENTIONS_RE:/@\w+\s?(?:\w+\s?){0,5}(?:\w+)?$/,isMention:function(a,c){var d;do{d=$(a);if(d.hasClass("mention")&&d.attr("data-cid"))return!0;a=a.parentElement}while(c&&a);return!1},getMentionHtml:function(a){return'<span contenteditable="true"><span contenteditable="false" data-cid="'+a.cid+'" class="mention">'+a.get("name")+"</span></span>&nbsp;"}}),
Y=Backbone.View.extend({events:{"click li":"onclick"},initialize:function(a){this.active=!1;this.thread=a.thread;this.mentionsCache=a.mentions},suggest:function(a){a=this.findMatches(a);if(!a||!a.length)return void this.clear();this.active=!0;this.el.innerHTML=DISQUS.renderBlock("suggestions",{users:_.map(a,function(a){return _.extend(a.toJSON(),{cid:a.cid})})});this.$el.find("li[data-cid]").first().addClass("active")},clear:function(){this.active=!1;this.el.innerHTML=""},onclick:function(a){this.select($(a.currentTarget).attr("data-cid"))},
findMatches:function(a){if(a&&a.length){for(var c=RegExp(a.join(" ").replace(/[^\w\s]/,""),"i"),d=Y.MAX_SUGGESTIONS,e=this.thread.users,f=[],h=0,i,a=a.length===1&&a[0]===""?function(){return!0}:function(a){return c.test(a.get("name"))||c.test(i.get("username"))},h=0;h<e.models.length&&f.length<d;h++)i=e.models[h],this.mentionsCache.getByCid(i.cid)||a(i)&&f.push(i);return f}},select:function(a){this.active&&(a||(a=this.$el.find(".active").attr("data-cid")),this.trigger("select",a),this.clear())},move:function(a){if(this.active){var c=
this.$el.find(".active"),a=c[a==="up"?"previous":"next"]();a.length&&a.attr("data-cid")&&(c.removeClass("active"),a.addClass("active"))}}},{MAX_SUGGESTIONS:5}),P=m.extend({tagName:"ul",className:"debug",initialize:function(a){this.values=a},render:function(){this.$el.empty();_.each(this.values,function(a,c){var d=document.createElement("li");d.innerHTML="<strong>"+c+"</strong>: "+a;this.$el.append(d)},this);return this}}),S=Backbone.View.extend({events:{"click [data-nav]":"_navTo"},initialize:function(){this.prevDestination=
this.activeNav()},_navTo:function(a){a.preventDefault();a=$(a.target);a=a.is("[data-nav]")?a:a.closest("[data-nav]");a=a.attr("data-nav");if(this.prevDestination==a)return!1;this.navTo(a)},navTo:function(a){this.prevDestination=a;var c=this.$el.find("[data-nav="+a+"]").parent();c.siblings("li").removeClass("active");c.addClass("active");this.trigger("nav",a)},activeNav:function(){if(this.prevDestination!=null)return this.prevDestination;return this.$el.find(".active [data-nav]").attr("data-nav")},
clear:function(){this.$el.find("li").removeClass("active");this.prevDestination=null}});return{Lounge:j,LoungeSubView:m,PostView:n,PostReplyView:v,PostEditView:t,ReactionView:X,UserMenuView:w,ThreadMenuView:x,QueuedPostView:C,QueuedReplyView:N,TypingUserView:M,CommunityView:R,TopThreadCollectionView:V,TopUserCollectionView:W,DashboardView:Q,NotificationCollectionView:U,NotificationCountView:L,ActivityCollectionView:J,ProfileView:H,HoverCard:s,ProfileCard:E,ContextCard:I,CaptchaView:K,AlertView:O,
BlacklistView:T,ContentEditableView:A,DebugInfoView:P}});var _comscore,_gaq;
(function(e){var d="",d="UA-1410476-6",f=e.getElementsByTagName("script")[0],i=f.parentNode,c=e.location.protocol=="https:";_comscore=_comscore||[];_comscore.push({c1:"7",c2:"10137436",c3:"1"});var k=document.createElement("script");k.async=!0;k.src=(c?"https://sb":"http://b")+".scorecardresearch.com/beacon.js";i.insertBefore(k,f);_gaq=_gaq||[];_gaq.push(["_setAccount",d]);_gaq.push(["_setDomainName",".disqus.com"]);e=e.createElement("script");e.type="text/javascript";e.async=!0;e.src=(c?"https://ssl":
"http://www")+".google-analytics.com/ga.js";i.insertBefore(e,f)})(document);DISQUS.define("ga",function(e){var d,f=function(c){d?d(c):e._gaq.push(c)},i={component:1,"package":2,forum:3,version:4,userType:5};return{setCaller:function(c){d=c},setAccount:function(c){f(["_setAccount",c])},setCustomVar:function(c,d){f(["_setCustomVar",i[c],c,d])},trackPageview:function(){f(["_trackPageview"])},trackEvent:function(c,d,a){f(["_trackEvent",d,c,a,1])},setDomainName:function(c){f(["_setDomainName",c])}}});
DISQUS.define("juggler",function(e){var d,f,i={},c=["thread","forum","forum_id"],k=c.slice().concat(["imp","event","prev_imp"]),a=[],h=(new Date).getTime().toString(10)+Math.floor(Math.random()*1E6).toString(10);return{load:function(k){function l(){d=function(){};a=[]}f=k.url;if(k.disable)return void l();if(e.location.protocol==="https:"){if(k.disableSSL)return void l();f=f.replace("http:","https:")}DISQUS.each(c,function(a){i[a]=k[a]});i.imp=h;i.prev_imp=DISQUS.cookies.read("__jid");DISQUS.cookies.create("__jid",
h,{expiresIn:18E5});d=function(a){DISQUS.each(i,function(c,d){a[d]=i[d]});DISQUS.require(f,a,!1)};DISQUS.each(a,function(a){d(a)})},emit:function(c,e){DISQUS.each(k,function(a){if(e[a]!=null)throw"Error: cannot overwrite event context '"+a+"'";});e.event=c;d==null?a.push(e):d(e)},impId:h}});
DISQUS.define("intelligence",function(e){function d(d,e){function c(a){if(!(a instanceof DISQUS.lounge.models.User)&&!(a instanceof DISQUS.lounge.models.AnonUser))throw Error("determineUserType(user) needs an instance of User/Anonuser");return a.has("remote")?a.get("remote").domain:a.id?"disqus":m?"guest":"not_logged_in"}function k(a){if(e.switches.length>0)a(e.switches);else e.switches.on("reset",a)}var a=e.initialData;if(_.isObject(a)&&!_.isEmpty(a)){var h=DISQUS.ga.setCustomVar,o=DISQUS.ga.trackPageview,
l=function(a){DISQUS.ga.trackEvent(a,r,q)},r="next",q=a.forum.id,j="not_logged_in",m=!1,x=a.features.support_preferred?"plus":a.features.support_priority?"pro":a.features.support_vip?"vip":"free";e.session.on("identify",function(){var m=this.user;k(function(c){c.enabled("juggler_thread_onReady")&&DISQUS.juggler.emit("init_embed",{thread_slug:a.thread.slug,user_type:m.get("user_type")||"anon",referrer:d.document.referrer,theme:"next"})});j=c(m);h("component","embed");h("package",x);h("forum",q);h("version",
r);h("userType",j);o();e.session.on("change:id",function(a){var d=j;j=c(a);d!=j&&(h("userType",j),l(j=="not_logged_in"||j=="guest"?"logout":"login"))})});k(function(c){DISQUS.juggler.load({disable:!c.enabled("juggler_enabled"),url:"http://juggler.services.disqus.com/event.js",disableSSL:c.enabled("next_disable_ssl_juggler"),thread:a.thread.id,forum:a.forum.id,forum_id:a.forum.pk})});DISQUS.each({inViewport:function(){l("view_embed");e.off("inViewport")},"uiAction:createPost":function(a){j=="not_logged_in"&&
(j="guest",h("userType",j));m=!0;a.get("parent")!=null?l("post_comment_reply"):l("post_comment")},"uiAction:postUpvote":function(){l("like_comment")},"uiAction:postDownvote":function(){l("dislike_comment")},"uiAction:threadUpvote":function(){l("like_thread")},"uiAction:postShare":function(a){l("share_comment_"+a)},"uiAction:threadShare":function(a){l("share_thread_"+a)},"uiAction:navigate":function(a){(a={community:"community",dashboard:"mydisqus",profile:"profile",reactions:"reactions"}[a])&&l("open_"+
a)},"uiAction:followUser":function(){l("follow_user")}},function(a,c){e.on(c,a)})}}return{init:function(f){d(e,f)}}});
(function(){DISQUS.log=function(){var e=DISQUS.lounge.views.Lounge.getInstance();window.console&&e&&e.switches&&e.switches.enabled("next_logging")&&(window.console.log.apply?window.console.log.apply(window.console,arguments):window.console.log(Array.prototype.slice.call(arguments,0).join(" ")))};DISQUS.logError=function(){var e=DISQUS.lounge.views.Lounge.getInstance(),d=Array.prototype.slice.call(arguments,0);DISQUS.log.apply(DISQUS,d);e.switches&&e.switches.enabled("next_raven")&&e.states.ravenConfigured&&
Raven.captureMessage({name:"DISQUS.logError",message:d.join(" ")})};$(document).ready(function(){function e(){$(".dropdown").removeClass("open")}$("html").bind("click",e);$("body").delegate("[data-toggle]","click",function(d){d.stopPropagation();d.preventDefault();var d=$(d.currentTarget),d=d.closest("."+d.attr("data-toggle")),f=d.attr("data-dropdown")!="disabled"&&!d.hasClass("open");d.attr("data-dropdown","enabled");e();f&&d.addClass("open")});DISQUS.Bus.bind("window.click",e)})})();